


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=windows-1252"> 
  <title>Coverage Report > QuestsDisplay</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">minicraft.screen</a>
</div>

<h1>Coverage Summary for Class: QuestsDisplay (minicraft.screen)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">QuestsDisplay</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/19)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/172)
  </span>
</td>
</tr>
  <tr>
    <td class="name">QuestsDisplay$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">QuestsDisplay$SeriesInformationDisplay</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/26)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">QuestsDisplay$SeriesInformationDisplay$SeriesQuestViewerDisplay</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/11)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/210)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">QuestsDisplay$SeriesInformationDisplay$SeriesQuestViewerDisplay$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/21)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">QuestsDisplay$SeriesInformationDisplay$SeriesQuestViewerDisplay$QuestInformationDisplay</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/19)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/36)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/450)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package minicraft.screen;
&nbsp;
&nbsp;import minicraft.core.CrashHandler;
&nbsp;import minicraft.core.Game;
&nbsp;import minicraft.core.Renderer;
&nbsp;import minicraft.core.io.InputHandler;
&nbsp;import minicraft.core.io.Localization;
&nbsp;import minicraft.core.io.Settings;
&nbsp;import minicraft.core.io.Sound;
&nbsp;import minicraft.gfx.Color;
&nbsp;import minicraft.gfx.Font;
&nbsp;import minicraft.gfx.MinicraftImage;
&nbsp;import minicraft.gfx.Point;
&nbsp;import minicraft.gfx.Rectangle;
&nbsp;import minicraft.gfx.Screen;
&nbsp;import minicraft.gfx.SpriteLinker;
&nbsp;import minicraft.saveload.Load;
&nbsp;import minicraft.screen.entry.BlankEntry;
&nbsp;import minicraft.screen.entry.ListEntry;
&nbsp;import minicraft.screen.entry.SelectEntry;
&nbsp;import minicraft.screen.entry.StringEntry;
&nbsp;import minicraft.util.AdvancementElement;
&nbsp;import minicraft.util.Logging;
&nbsp;import minicraft.util.Quest;
&nbsp;import minicraft.util.Quest.QuestSeries;
&nbsp;import org.json.JSONArray;
&nbsp;import org.json.JSONObject;
&nbsp;
&nbsp;import java.awt.image.BufferedImage;
&nbsp;import java.awt.image.DataBufferInt;
&nbsp;import java.io.IOException;
&nbsp;import java.io.UncheckedIOException;
&nbsp;import java.util.ArrayList;
&nbsp;import java.util.Arrays;
&nbsp;import java.util.Collections;
&nbsp;import java.util.HashMap;
&nbsp;import java.util.HashSet;
&nbsp;import java.util.Iterator;
&nbsp;import java.util.Map;
&nbsp;import java.util.function.IntPredicate;
&nbsp;import java.util.stream.Collectors;
&nbsp;
&nbsp;public class QuestsDisplay extends Display {
&nbsp;	/**
&nbsp;	 * Unlocked but uncompleted.
&nbsp;	 */
<b class="nc">&nbsp;	private final static HashSet&lt;Quest&gt; displayableQuests = new HashSet&lt;&gt;(); // Temp set. Refreshed anytime.</b>
<b class="nc">&nbsp;	private final static HashSet&lt;QuestSeries&gt; series = new HashSet&lt;&gt;();</b>
&nbsp;
&nbsp;	private SelectEntry[][] seriesEntries;
<b class="nc">&nbsp;	private int selectedEntry = 0;</b>
&nbsp;	private QuestSeries[][] entrySeries;
<b class="nc">&nbsp;	private int previousSelection = 0;</b>
&nbsp;
&nbsp;	static {
&nbsp;		try { // TODO Data pack support.
<b class="nc">&nbsp;			loadQuestFile(&quot;/resources/quests.json&quot;);</b>
<b class="nc">&nbsp;		} catch (IOException e) {</b>
<b class="nc">&nbsp;			e.printStackTrace();</b>
<b class="nc">&nbsp;			Logging.QUEST.error(&quot;Failed to load quests.&quot;);</b>
<b class="nc">&nbsp;		}</b>
&nbsp;	}
&nbsp;
&nbsp;	private static void loadQuestFile(@SuppressWarnings(&quot;SameParameterValue&quot;) String filename) throws IOException {
<b class="nc">&nbsp;		JSONObject json = new JSONObject(String.join(&quot;&quot;, Load.loadFile(filename)));</b>
<b class="nc">&nbsp;		for (String key : json.keySet()) {</b>
<b class="nc">&nbsp;			loadSeries(key, json.getJSONObject(key));</b>
<b class="nc">&nbsp;		}</b>
&nbsp;	}
&nbsp;
&nbsp;	private static void loadSeries(String key, JSONObject json) {
<b class="nc">&nbsp;		HashMap&lt;String, AdvancementElement.ElementCriterion&gt; criteria = new HashMap&lt;&gt;();</b>
<b class="nc">&nbsp;		JSONObject criteriaJson = json.optJSONObject(&quot;criteria&quot;); // Optional</b>
<b class="nc">&nbsp;		if (criteriaJson != null) {</b>
<b class="nc">&nbsp;			for (String k : criteriaJson.keySet()) {</b>
<b class="nc">&nbsp;				JSONObject criterion = criteriaJson.getJSONObject(k);</b>
<b class="nc">&nbsp;				criteria.put(k, new AdvancementElement.ElementCriterion(criterion.getString(&quot;trigger&quot;), criterion.getJSONObject(&quot;conditions&quot;)));</b>
<b class="nc">&nbsp;			}</b>
&nbsp;		}
&nbsp;
<b class="nc">&nbsp;		HashSet&lt;HashSet&lt;String&gt;&gt; requirements = new HashSet&lt;&gt;();</b>
<b class="nc">&nbsp;		JSONArray requirementsJson = json.optJSONArray(&quot;requirements&quot;);</b>
<b class="nc">&nbsp;		if (requirementsJson != null) {</b>
<b class="nc">&nbsp;			for (int i = 0; i &lt; requirementsJson.length(); i++) {</b>
<b class="nc">&nbsp;				HashSet&lt;String&gt; req = new HashSet&lt;&gt;();</b>
<b class="nc">&nbsp;				JSONArray reqJson = requirementsJson.getJSONArray(i);</b>
<b class="nc">&nbsp;				for (int j = 0; j &lt; reqJson.length(); j++) {</b>
<b class="nc">&nbsp;					req.add(reqJson.getString(j));</b>
&nbsp;				}
<b class="nc">&nbsp;				requirements.add(req);</b>
&nbsp;			}
&nbsp;		}
&nbsp;
<b class="nc">&nbsp;		HashMap&lt;String, AdvancementElement.ElementCriterion&gt; unlockingCriteria = new HashMap&lt;&gt;();</b>
<b class="nc">&nbsp;		JSONObject unlockingCriteriaJson = json.getJSONObject(&quot;unlocking_criteria&quot;);</b>
<b class="nc">&nbsp;		for (String k : unlockingCriteriaJson.keySet()) {</b>
<b class="nc">&nbsp;			JSONObject criterion = unlockingCriteriaJson.getJSONObject(k);</b>
<b class="nc">&nbsp;			unlockingCriteria.put(k, new AdvancementElement.ElementCriterion(criterion.getString(&quot;trigger&quot;), criterion.getJSONObject(&quot;conditions&quot;)));</b>
<b class="nc">&nbsp;		}</b>
&nbsp;
<b class="nc">&nbsp;		HashSet&lt;HashSet&lt;String&gt;&gt; unlockingRequirements = new HashSet&lt;&gt;();</b>
<b class="nc">&nbsp;		JSONArray unlockingRequirementsJson = json.optJSONArray(&quot;unlocking_requirements&quot;);</b>
<b class="nc">&nbsp;		if (requirementsJson != null) {</b>
<b class="nc">&nbsp;			for (int i = 0; i &lt; unlockingRequirementsJson.length(); i++) {</b>
<b class="nc">&nbsp;				HashSet&lt;String&gt; req = new HashSet&lt;&gt;();</b>
<b class="nc">&nbsp;				JSONArray reqJson = unlockingRequirementsJson.getJSONArray(i);</b>
<b class="nc">&nbsp;				for (int j = 0; j &lt; reqJson.length(); j++) {</b>
<b class="nc">&nbsp;					req.add(reqJson.getString(j));</b>
&nbsp;				}
<b class="nc">&nbsp;				unlockingRequirements.add(req);</b>
&nbsp;			}
&nbsp;		}
&nbsp;
<b class="nc">&nbsp;		HashMap&lt;String, Quest&gt; quests = new HashMap&lt;&gt;();</b>
<b class="nc">&nbsp;		JSONObject questsJson = json.getJSONObject(&quot;quests&quot;);</b>
<b class="nc">&nbsp;		for (String k : questsJson.keySet()) {</b>
<b class="nc">&nbsp;			Quest quest = loadQuest(k, questsJson.getJSONObject(k));</b>
<b class="nc">&nbsp;			quests.put(quest.key, quest);</b>
<b class="nc">&nbsp;		}</b>
&nbsp;
<b class="nc">&nbsp;		AdvancementElement.ElementRewards rewards = AdvancementElement.loadRewards(json.optJSONObject(&quot;rewards&quot;));</b>
<b class="nc">&nbsp;		series.add(new QuestSeries(key, json.getString(&quot;description&quot;), criteria,</b>
&nbsp;			rewards, requirements, quests, unlockingCriteria, unlockingRequirements));
&nbsp;	}
&nbsp;
&nbsp;	private static Quest loadQuest(String key, JSONObject json) {
<b class="nc">&nbsp;		HashMap&lt;String, AdvancementElement.ElementCriterion&gt; criteria = new HashMap&lt;&gt;();</b>
<b class="nc">&nbsp;		JSONObject criteriaJson = json.getJSONObject(&quot;criteria&quot;);</b>
<b class="nc">&nbsp;		if (criteriaJson.isEmpty()) throw new IndexOutOfBoundsException(&quot;criteria is empty.&quot;);</b>
<b class="nc">&nbsp;		for (String k : criteriaJson.keySet()) {</b>
<b class="nc">&nbsp;			JSONObject criterion = criteriaJson.getJSONObject(k);</b>
<b class="nc">&nbsp;			criteria.put(k, new AdvancementElement.ElementCriterion(criterion.getString(&quot;trigger&quot;), criterion.getJSONObject(&quot;conditions&quot;)));</b>
<b class="nc">&nbsp;		}</b>
&nbsp;
<b class="nc">&nbsp;		HashSet&lt;HashSet&lt;String&gt;&gt; requirements = new HashSet&lt;&gt;();</b>
<b class="nc">&nbsp;		JSONArray requirementsJson = json.optJSONArray(&quot;requirements&quot;);</b>
<b class="nc">&nbsp;		if (requirementsJson != null) {</b>
<b class="nc">&nbsp;			for (int i = 0; i &lt; requirementsJson.length(); i++) {</b>
<b class="nc">&nbsp;				HashSet&lt;String&gt; req = new HashSet&lt;&gt;();</b>
<b class="nc">&nbsp;				JSONArray reqJson = requirementsJson.getJSONArray(i);</b>
<b class="nc">&nbsp;				for (int j = 0; j &lt; reqJson.length(); j++) {</b>
<b class="nc">&nbsp;					req.add(reqJson.getString(j));</b>
&nbsp;				}
<b class="nc">&nbsp;				requirements.add(req);</b>
&nbsp;			}
&nbsp;		}
&nbsp;
<b class="nc">&nbsp;		HashMap&lt;String, AdvancementElement.ElementCriterion&gt; unlockingCriteria = new HashMap&lt;&gt;();</b>
<b class="nc">&nbsp;		JSONObject unlockingCriteriaJson = json.optJSONObject(&quot;unlocking_criteria&quot;);</b>
<b class="nc">&nbsp;		if (unlockingCriteriaJson != null) {</b>
<b class="nc">&nbsp;			for (String k : unlockingCriteriaJson.keySet()) {</b>
<b class="nc">&nbsp;				JSONObject criterion = unlockingCriteriaJson.getJSONObject(k);</b>
<b class="nc">&nbsp;				unlockingCriteria.put(k, new AdvancementElement.ElementCriterion(criterion.getString(&quot;trigger&quot;), criterion.getJSONObject(&quot;conditions&quot;)));</b>
<b class="nc">&nbsp;			}</b>
&nbsp;		}
&nbsp;
<b class="nc">&nbsp;		HashSet&lt;HashSet&lt;String&gt;&gt; unlockingRequirements = new HashSet&lt;&gt;();</b>
<b class="nc">&nbsp;		JSONArray unlockingRequirementsJson = json.optJSONArray(&quot;unlocking_requirements&quot;);</b>
<b class="nc">&nbsp;		if (requirementsJson != null) {</b>
<b class="nc">&nbsp;			for (int i = 0; i &lt; unlockingRequirementsJson.length(); i++) {</b>
<b class="nc">&nbsp;				HashSet&lt;String&gt; req = new HashSet&lt;&gt;();</b>
<b class="nc">&nbsp;				JSONArray reqJson = unlockingRequirementsJson.getJSONArray(i);</b>
<b class="nc">&nbsp;				for (int j = 0; j &lt; reqJson.length(); j++) {</b>
<b class="nc">&nbsp;					req.add(reqJson.getString(j));</b>
&nbsp;				}
<b class="nc">&nbsp;				unlockingRequirements.add(req);</b>
&nbsp;			}
&nbsp;		}
&nbsp;
<b class="nc">&nbsp;		AdvancementElement.ElementRewards rewards = AdvancementElement.loadRewards(json.optJSONObject(&quot;rewards&quot;));</b>
<b class="nc">&nbsp;		return new Quest(key, json.getString(&quot;description&quot;), criteria,</b>
<b class="nc">&nbsp;			rewards, requirements, json.optString(&quot;parent&quot;, null), unlockingCriteria, unlockingRequirements);</b>
&nbsp;	}
&nbsp;
&nbsp;	public static void refreshDisplayableQuests() {
<b class="nc">&nbsp;		displayableQuests.clear();</b>
<b class="nc">&nbsp;		series.forEach(series -&gt; {</b>
<b class="nc">&nbsp;			if (series.isDisplayableAtStatus())</b>
<b class="nc">&nbsp;				series.getSeriesQuests().values().forEach(quest -&gt; {</b>
<b class="nc">&nbsp;					if (quest.isDisplayableAtStatus())</b>
<b class="nc">&nbsp;						displayableQuests.add(quest);</b>
&nbsp;				});
&nbsp;		});
&nbsp;	}
&nbsp;
&nbsp;	private void reloadEntries() {
<b class="nc">&nbsp;		ArrayList&lt;SelectEntry&gt; completed = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;		ArrayList&lt;SelectEntry&gt; unlocked = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;		ArrayList&lt;QuestSeries&gt; completedSeries = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;		ArrayList&lt;QuestSeries&gt; unlockedSeries = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;		for (QuestSeries questSeries : series) {</b>
<b class="nc">&nbsp;			boolean isCompleted = questSeries.isCompleted();</b>
<b class="nc">&nbsp;			boolean isUnlocked = questSeries.isUnlocked();</b>
<b class="nc">&nbsp;			SelectEntry select = new SelectEntry(Localization.getLocalized(questSeries.key), () -&gt; Game.setDisplay(new SeriesInformationDisplay(questSeries)), true) {</b>
&nbsp;				@Override
&nbsp;				public int getColor(boolean isSelected) {
<b class="nc">&nbsp;					return isCompleted ? Color.GREEN : isUnlocked ? Color.WHITE : Color.GRAY;</b>
&nbsp;				}
&nbsp;			};
&nbsp;
<b class="nc">&nbsp;			if (isCompleted) {</b>
<b class="nc">&nbsp;				completed.add(select);</b>
<b class="nc">&nbsp;				completedSeries.add(questSeries);</b>
&nbsp;			}
&nbsp;
<b class="nc">&nbsp;			if (isUnlocked) {</b>
<b class="nc">&nbsp;				unlocked.add(select);</b>
<b class="nc">&nbsp;				unlockedSeries.add(questSeries);</b>
&nbsp;			}
<b class="nc">&nbsp;		}</b>
&nbsp;
<b class="nc">&nbsp;		seriesEntries = new SelectEntry[][] {</b>
<b class="nc">&nbsp;			unlocked.toArray(new SelectEntry[0]),</b>
<b class="nc">&nbsp;			completed.toArray(new SelectEntry[0])</b>
&nbsp;		};
&nbsp;
<b class="nc">&nbsp;		entrySeries = new QuestSeries[][] {</b>
<b class="nc">&nbsp;			unlockedSeries.toArray(new QuestSeries[0]),</b>
<b class="nc">&nbsp;			completedSeries.toArray(new QuestSeries[0])</b>
&nbsp;		};
&nbsp;	}
&nbsp;
&nbsp;	public QuestsDisplay() {
<b class="nc">&nbsp;		super(true, true);</b>
<b class="nc">&nbsp;		reloadEntries();</b>
&nbsp;
<b class="nc">&nbsp;		menus = new Menu[] {</b>
&nbsp;			new Menu.Builder(false, 1, RelPos.CENTER)
<b class="nc">&nbsp;				.setPositioning(new Point(Screen.w / 2, Screen.h / 2 - 20), RelPos.CENTER)</b>
<b class="nc">&nbsp;				.setDisplayLength(5)</b>
<b class="nc">&nbsp;				.setSelectable(true)</b>
<b class="nc">&nbsp;				.createMenu(),</b>
&nbsp;			new Menu.Builder(false, 0, RelPos.LEFT)
<b class="nc">&nbsp;				.setPositioning(new Point(Screen.w / 2 - 8 * (2 + Localization.getLocalized(&quot;minicraft.displays.quests.display.header.unlocked&quot;).length()), 30), RelPos.RIGHT)</b>
<b class="nc">&nbsp;				.setEntries(new StringEntry(&quot;minicraft.displays.quests.display.header.unlocked&quot;, Color.GRAY))</b>
<b class="nc">&nbsp;				.setSelectable(false)</b>
<b class="nc">&nbsp;				.createMenu(),</b>
&nbsp;			new Menu.Builder(false, 0, RelPos.LEFT)
<b class="nc">&nbsp;				.setPositioning(new Point(Screen.w / 2 + 8 * 2, 30), RelPos.RIGHT)</b>
<b class="nc">&nbsp;				.setEntries(new StringEntry(&quot;minicraft.displays.quests.display.header.completed&quot;, Color.GRAY))</b>
<b class="nc">&nbsp;				.setSelectable(false)</b>
<b class="nc">&nbsp;				.createMenu(),</b>
&nbsp;			new Menu.Builder(false, 0, RelPos.CENTER)
<b class="nc">&nbsp;				.setPositioning(new Point(Screen.w / 2, Screen.h / 2 + 35), RelPos.CENTER)</b>
<b class="nc">&nbsp;				.setEntries(new StringEntry(Localization.getLocalized(&quot;minicraft.displays.quests.display.no_quest_desc&quot;)))</b>
<b class="nc">&nbsp;				.setSelectable(false)</b>
<b class="nc">&nbsp;				.createMenu(),</b>
&nbsp;			new Menu.Builder(false, 0, RelPos.CENTER)
<b class="nc">&nbsp;				.setPositioning(new Point(Screen.w / 2, 10), RelPos.CENTER)</b>
<b class="nc">&nbsp;				.setEntries(new StringEntry(Settings.getEntry(&quot;quests&quot;).toString(), Color.WHITE))</b>
<b class="nc">&nbsp;				.setSelectable(false)</b>
<b class="nc">&nbsp;				.createMenu()</b>
&nbsp;		};
&nbsp;
<b class="nc">&nbsp;		updateEntries();</b>
&nbsp;	}
&nbsp;
&nbsp;	public static class SeriesInformationDisplay extends Display {
&nbsp;		public SeriesInformationDisplay(QuestSeries series) {
<b class="nc">&nbsp;			super(false, true);</b>
<b class="nc">&nbsp;			ArrayList&lt;ListEntry&gt; entries = new ArrayList&lt;&gt;();</b>
&nbsp;
<b class="nc">&nbsp;			entries.add(series.isCompleted() ? new StringEntry(Localization.getLocalized(&quot;minicraft.displays.quests.quest_info.display.status&quot;,</b>
<b class="nc">&nbsp;				Localization.getLocalized(&quot;minicraft.displays.quests.quest_info.display.status.completed&quot;)), Color.GREEN, false) :</b>
<b class="nc">&nbsp;				series.isUnlocked() ? new StringEntry(Localization.getLocalized(&quot;minicraft.displays.quests.quest_info.display.status&quot;,</b>
<b class="nc">&nbsp;					Localization.getLocalized(&quot;minicraft.displays.quests.quest_info.display.status.unlocked&quot;)), Color.WHITE, false) :</b>
<b class="nc">&nbsp;					new StringEntry(Localization.getLocalized(&quot;minicraft.displays.quests.quest_info.display.status&quot;,</b>
<b class="nc">&nbsp;						Localization.getLocalized(&quot;minicraft.displays.quests.quest_info.display.status.locked&quot;)), Color.GRAY, false) // Locked series would not been shown...?</b>
&nbsp;			);
&nbsp;
<b class="nc">&nbsp;			entries.add(new StringEntry(Localization.getLocalized(&quot;minicraft.displays.quests.quest_info.display.quests_completed_count&quot;,</b>
<b class="nc">&nbsp;				series.getSeriesQuests().values().stream().filter(AdvancementElement::isCompleted).count()), Color.WHITE, false));</b>
<b class="nc">&nbsp;			entries.addAll(Arrays.asList(StringEntry.useLines(Color.WHITE, false,</b>
<b class="nc">&nbsp;				Localization.getLocalized(&quot;minicraft.displays.quests.quest_info.display.description&quot;, Localization.getLocalized(series.description)))));</b>
<b class="nc">&nbsp;			entries.add(new StringEntry(Localization.getLocalized(&quot;minicraft.displays.quests.quest_info.display.ongoing_quests&quot;,</b>
<b class="nc">&nbsp;				series.getSeriesQuests().values().stream().filter(AdvancementElement::isDisplayableAtStatus).count()), Color.WHITE, false));</b>
&nbsp;
<b class="nc">&nbsp;			entries.add(new BlankEntry());</b>
<b class="nc">&nbsp;			entries.add(new SelectEntry(&quot;minicraft.displays.quests.quest_info.view_quests&quot;, () -&gt; Game.setDisplay(new SeriesQuestViewerDisplay(series))));</b>
&nbsp;
<b class="nc">&nbsp;			menus = new Menu[] {</b>
&nbsp;				new Menu.Builder(true, 0, RelPos.CENTER)
<b class="nc">&nbsp;					.setPositioning(new Point(Screen.w / 2, 5), RelPos.BOTTOM)</b>
<b class="nc">&nbsp;					.setEntries(new StringEntry(Localization.getLocalized(series.key)))</b>
<b class="nc">&nbsp;					.setSelectable(false)</b>
<b class="nc">&nbsp;					.createMenu(),</b>
&nbsp;				new Menu.Builder(true, 2, RelPos.CENTER)
<b class="nc">&nbsp;					.setPositioning(new Point(Screen.w / 2, 30), RelPos.BOTTOM)</b>
<b class="nc">&nbsp;					.setEntries(entries)</b>
<b class="nc">&nbsp;					.setSelectable(true)</b>
<b class="nc">&nbsp;					.createMenu()</b>
&nbsp;			};
&nbsp;
<b class="nc">&nbsp;			selection = 1;</b>
&nbsp;		}
&nbsp;
<b class="nc">&nbsp;		private static class SeriesQuestViewerDisplay extends Display {</b>
&nbsp;			private static final int entryPadding = 3;
&nbsp;			private static final int entryGap = 5; // 2x for y-axis only when between entries.
&nbsp;			private final Menu[] menus;
&nbsp;			private final Quest[][] questsTree;
&nbsp;			private final Rectangle[][] treeDimensions;
<b class="nc">&nbsp;			private final HashMap&lt;Quest, Quest&gt; parents = new HashMap&lt;&gt;();</b>
&nbsp;			private final int rasterWidth;
&nbsp;			private final int rasterHeight;
&nbsp;			private final int rasterX;
&nbsp;			private final int rasterY;
&nbsp;			private final MinicraftImage image;
&nbsp;			private final int[] rasterPixels;
<b class="nc">&nbsp;			private final Screen simulatedRasterScreen = new Screen(new BufferedImage(Screen.w, Screen.h, BufferedImage.TYPE_INT_RGB)) {</b>
&nbsp;				@Override
&nbsp;				public void render(int xp, int yp, int xt, int yt, int bits, MinicraftImage sheet, int whiteTint, boolean fullbright, int color) {
<b class="nc">&nbsp;					if (sheet == null) return; // Verifying that sheet is not null.</b>
&nbsp;					// Ignoring mirror.
&nbsp;					// Validation check
<b class="nc">&nbsp;					if (xt * 8 + yt * 8 * sheet.width + 7 + 7 * sheet.width &gt;= sheet.pixels.length) {</b>
<b class="nc">&nbsp;						sheet = Renderer.spriteLinker.missingSheet(SpriteLinker.SpriteType.Item);</b>
<b class="nc">&nbsp;						xt = 0;</b>
<b class="nc">&nbsp;						yt = 0;</b>
&nbsp;					}
&nbsp;
<b class="nc">&nbsp;					int xTile = xt; // Gets x position of the spritesheet &quot;tile&quot;</b>
<b class="nc">&nbsp;					int yTile = yt; // Gets y position</b>
<b class="nc">&nbsp;					int toffs = xTile * 8 + yTile * 8 * sheet.width; // Gets the offset of the sprite into the spritesheet pixel array, the 8&#39;s represent the size of the box. (8 by 8 pixel sprite boxes)</b>
&nbsp;
&nbsp;					// THIS LOOPS FOR EVERY PIXEL
<b class="nc">&nbsp;					for (int y = 0; y &lt; 8; y++) { // Loops 8 times (because of the height of the tile)</b>
<b class="nc">&nbsp;						for (int x = 0; x &lt; 8; x++) { // Loops 8 times (because of the width of the tile)</b>
<b class="nc">&nbsp;							int col = sheet.pixels[toffs + x + y * sheet.width]; // Gets the color of the current pixel from the value stored in the sheet.</b>
<b class="nc">&nbsp;							boolean isTransparent = (col &gt;&gt; 24 == 0);</b>
<b class="nc">&nbsp;							if (!isTransparent) {</b>
<b class="nc">&nbsp;								if (whiteTint != -1 &amp;&amp; col == 0x1FFFFFF) {</b>
&nbsp;									// If this is white, write the whiteTint over it
<b class="nc">&nbsp;									renderRasterPixel(x + xp, y + yp, whiteTint &amp; 0xFFFFFF);</b>
&nbsp;								} else {
&nbsp;									// Inserts the colors into the image
<b class="nc">&nbsp;									if (fullbright) {</b>
<b class="nc">&nbsp;										renderRasterPixel(x + xp, y + yp, Color.WHITE);</b>
&nbsp;									} else {
<b class="nc">&nbsp;										if (color != 0) {</b>
<b class="nc">&nbsp;											renderRasterPixel(x + xp, y + yp, color);</b>
&nbsp;										} else {
<b class="nc">&nbsp;											renderRasterPixel(x + xp, y + yp, col &amp; 0xFFFFFF);</b>
&nbsp;										}
&nbsp;									}
&nbsp;								}
&nbsp;							}
&nbsp;						}
&nbsp;					}
&nbsp;				}
&nbsp;			};
&nbsp;
<b class="nc">&nbsp;			private int cursorX = 0;</b>
<b class="nc">&nbsp;			private int cursorY = 0;</b>
<b class="nc">&nbsp;			private int xScroll = 0;</b>
<b class="nc">&nbsp;			private int yScroll = 0;</b>
<b class="nc">&nbsp;			private boolean inBrowsing = false; // Simple check;</b>
&nbsp;
&nbsp;			public SeriesQuestViewerDisplay(QuestSeries series) {
<b class="nc">&nbsp;				super(false, true);</b>
<b class="nc">&nbsp;				menus = new Menu[] {</b>
<b class="nc">&nbsp;					new Menu.Builder(true, 0, RelPos.CENTER, StringEntry.useLines(&quot;minicraft.displays.quests&quot;, series.key))</b>
<b class="nc">&nbsp;						.setPositioning(new Point(Screen.w / 2, 6), RelPos.BOTTOM)</b>
<b class="nc">&nbsp;						.createMenu(),</b>
&nbsp;					new Menu.Builder(true, 0, RelPos.CENTER)
<b class="nc">&nbsp;						.setPositioning(new Point(Screen.w / 2, 40), RelPos.BOTTOM)</b>
<b class="nc">&nbsp;						.setSize(Screen.w - 16, Screen.h - 60)</b>
<b class="nc">&nbsp;						.createMenu()</b>
&nbsp;				};
&nbsp;
<b class="nc">&nbsp;				Map&lt;String, Quest&gt; quests = series.getSeriesQuests()</b>
<b class="nc">&nbsp;					.entrySet().stream().filter(entry -&gt; entry.getValue().isUnlocked()) // Showing unlocked only.</b>
<b class="nc">&nbsp;					.collect(Collectors.toMap(Map.Entry::getKey, Map.Entry::getValue));</b>
<b class="nc">&nbsp;				if (!quests.isEmpty()) {</b>
<b class="nc">&nbsp;					ArrayList&lt;ArrayList&lt;Quest&gt;&gt; questRowsList = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;					ArrayList&lt;Quest&gt; topRow = quests.values().stream().filter(quest -&gt; quest.getParent() == null).collect(Collectors.toCollection(ArrayList::new));</b>
<b class="nc">&nbsp;					questRowsList.add(topRow);</b>
<b class="nc">&nbsp;					HashMap&lt;Quest, HashSet&lt;Quest&gt;&gt; childQuests = new HashMap&lt;&gt;();</b>
<b class="nc">&nbsp;					quests.values().forEach(quest -&gt; {</b>
<b class="nc">&nbsp;						Quest parent = quest.getParent();</b>
<b class="nc">&nbsp;						if (parent != null) {</b>
<b class="nc">&nbsp;							parents.put(quest, parent);</b>
<b class="nc">&nbsp;							if (childQuests.containsKey(parent))</b>
<b class="nc">&nbsp;								childQuests.get(parent).add(quest);</b>
&nbsp;							else
<b class="nc">&nbsp;								childQuests.put(parent, new HashSet&lt;&gt;(Collections.singletonList(quest)));</b>
&nbsp;						}
&nbsp;					});
&nbsp;
<b class="nc">&nbsp;					while (childQuests.size() &gt; 0) {</b>
<b class="nc">&nbsp;						for (Iterator&lt;Map.Entry&lt;Quest, HashSet&lt;Quest&gt;&gt;&gt; it = childQuests.entrySet().iterator(); it.hasNext(); ) {</b>
<b class="nc">&nbsp;							Map.Entry&lt;Quest, HashSet&lt;Quest&gt;&gt; entry = it.next();</b>
<b class="nc">&nbsp;							Quest parent = entry.getKey();</b>
<b class="nc">&nbsp;							ArrayList&lt;Quest&gt; questRow = questRowsList.stream().filter(quests1 -&gt; quests1.contains(parent)).findAny().orElse(null);</b>
<b class="nc">&nbsp;							if (questRow != null) {</b>
<b class="nc">&nbsp;								if (questRowsList.indexOf(questRow) &lt; questRowsList.size() - 1) {</b>
<b class="nc">&nbsp;									questRowsList.get(questRowsList.indexOf(questRow) + 1).addAll(entry.getValue());</b>
&nbsp;								} else { // The row is the last element.
<b class="nc">&nbsp;									questRowsList.add(new ArrayList&lt;&gt;(entry.getValue()));</b>
&nbsp;								}
<b class="nc">&nbsp;								it.remove();</b>
&nbsp;							}
<b class="nc">&nbsp;						}</b>
&nbsp;					}
&nbsp;
<b class="nc">&nbsp;					questsTree = questRowsList.stream().map(quests1 -&gt; quests1.toArray(new Quest[0])).toArray(Quest[][]::new);</b>
<b class="nc">&nbsp;					treeDimensions = new Rectangle[questsTree.length][];</b>
<b class="nc">&nbsp;					for (int i = 0; i &lt; questsTree.length; i++) { // y-axis</b>
<b class="nc">&nbsp;						treeDimensions[i] = new Rectangle[questsTree[i].length];</b>
<b class="nc">&nbsp;						int height = Font.textHeight();</b>
<b class="nc">&nbsp;						for (int j = 0; j &lt; questsTree[i].length; j++) { // x-axis</b>
<b class="nc">&nbsp;							int width = Font.textWidth(Localization.getLocalized(questsTree[i][j].key));</b>
<b class="nc">&nbsp;							treeDimensions[i][j] = new Rectangle(entryGap, entryGap, entryPadding * 2 + width, entryPadding * 2 + height, 0);</b>
<b class="nc">&nbsp;							if (j &gt; 0)</b>
<b class="nc">&nbsp;								treeDimensions[i][j].translate(treeDimensions[i][j - 1].getRight() + entryGap, 0);</b>
<b class="nc">&nbsp;							if (i &gt; 0)</b>
<b class="nc">&nbsp;								treeDimensions[i][j].translate(0, treeDimensions[i - 1][0].getBottom() + entryGap * 2);</b>
&nbsp;						}
&nbsp;					}
<b class="nc">&nbsp;				} else {</b>
<b class="nc">&nbsp;					questsTree = new Quest[0][];</b>
<b class="nc">&nbsp;					treeDimensions = new Rectangle[0][];</b>
&nbsp;				}
&nbsp;
<b class="nc">&nbsp;				Rectangle menuBounds = menus[1].getBounds();</b>
<b class="nc">&nbsp;				rasterWidth = menuBounds.getWidth() - MinicraftImage.boxWidth * 2;</b>
<b class="nc">&nbsp;				rasterHeight = menuBounds.getHeight() - MinicraftImage.boxWidth * 2;</b>
<b class="nc">&nbsp;				image = new MinicraftImage(rasterWidth, rasterHeight);</b>
<b class="nc">&nbsp;				rasterPixels = image.pixels;</b>
<b class="nc">&nbsp;				rasterX = menuBounds.getLeft() + MinicraftImage.boxWidth;</b>
<b class="nc">&nbsp;				rasterY = menuBounds.getTop() + MinicraftImage.boxWidth;</b>
&nbsp;			}
&nbsp;
&nbsp;			@Override
&nbsp;			public void tick(InputHandler input) {
<b class="nc">&nbsp;				super.tick(input);</b>
&nbsp;
<b class="nc">&nbsp;				if (questsTree.length &gt; 0) {</b>
<b class="nc">&nbsp;					if (input.getMappedKey(&quot;shift&quot;).isDown()) { // Browsing mode.</b>
<b class="nc">&nbsp;						inBrowsing = true;</b>
<b class="nc">&nbsp;						if (input.getMappedKey(&quot;shift+cursor-down&quot;).isClicked())</b>
<b class="nc">&nbsp;							yScroll += 3;</b>
<b class="nc">&nbsp;						else if (input.getMappedKey(&quot;shift+cursor-up&quot;).isClicked())</b>
<b class="nc">&nbsp;							yScroll -= 3;</b>
<b class="nc">&nbsp;						else if (input.getMappedKey(&quot;shift+cursor-right&quot;).isClicked())</b>
<b class="nc">&nbsp;							xScroll += 3;</b>
<b class="nc">&nbsp;						else if (input.getMappedKey(&quot;shift+cursor-left&quot;).isClicked())</b>
<b class="nc">&nbsp;							xScroll -= 3;</b>
&nbsp;					} else {
<b class="nc">&nbsp;						if (inBrowsing) {</b>
<b class="nc">&nbsp;							scrollIfNeeded();</b>
<b class="nc">&nbsp;							inBrowsing = false;</b>
&nbsp;						}
<b class="nc">&nbsp;						if (input.getMappedKey(&quot;cursor-down&quot;).isClicked()) {</b>
<b class="nc">&nbsp;							if (cursorY &lt; questsTree.length - 1) {</b>
<b class="nc">&nbsp;								cursorY++;</b>
<b class="nc">&nbsp;								if (cursorX &gt;= questsTree[cursorY].length)</b>
<b class="nc">&nbsp;									cursorX = questsTree[cursorY].length - 1;</b>
<b class="nc">&nbsp;								Sound.play(&quot;select&quot;);</b>
<b class="nc">&nbsp;								scrollIfNeeded();</b>
&nbsp;							}
<b class="nc">&nbsp;						} else if (input.getMappedKey(&quot;cursor-up&quot;).isClicked()) {</b>
<b class="nc">&nbsp;							if (cursorY &gt; 0) {</b>
<b class="nc">&nbsp;								cursorY--;</b>
<b class="nc">&nbsp;								if (cursorX &gt;= questsTree[cursorY].length)</b>
<b class="nc">&nbsp;									cursorX = questsTree[cursorY].length - 1;</b>
<b class="nc">&nbsp;								Sound.play(&quot;select&quot;);</b>
<b class="nc">&nbsp;								scrollIfNeeded();</b>
&nbsp;							}
<b class="nc">&nbsp;						} else if (input.getMappedKey(&quot;cursor-right&quot;).isClicked()) {</b>
<b class="nc">&nbsp;							if (cursorX &lt; questsTree[cursorY].length - 1) {</b>
<b class="nc">&nbsp;								cursorX++;</b>
<b class="nc">&nbsp;								Sound.play(&quot;select&quot;);</b>
<b class="nc">&nbsp;								scrollIfNeeded();</b>
&nbsp;							}
<b class="nc">&nbsp;						} else if (input.getMappedKey(&quot;cursor-left&quot;).isClicked()) {</b>
<b class="nc">&nbsp;							if (cursorX &gt; 0) {</b>
<b class="nc">&nbsp;								cursorX--;</b>
<b class="nc">&nbsp;								Sound.play(&quot;select&quot;);</b>
<b class="nc">&nbsp;								scrollIfNeeded();</b>
&nbsp;							}
<b class="nc">&nbsp;						} else if (input.getMappedKey(&quot;select&quot;).isClicked()) {</b>
<b class="nc">&nbsp;							Sound.play(&quot;confirm&quot;);</b>
<b class="nc">&nbsp;							Game.setDisplay(new QuestInformationDisplay(questsTree[cursorY][cursorX]));</b>
&nbsp;						}
&nbsp;					}
&nbsp;				}
&nbsp;			}
&nbsp;
&nbsp;			private void scrollIfNeeded() {
<b class="nc">&nbsp;				if (xScroll &gt; treeDimensions[cursorY][cursorX].getLeft() - entryGap)</b>
<b class="nc">&nbsp;					xScroll = treeDimensions[cursorY][cursorX].getLeft() - entryGap;</b>
<b class="nc">&nbsp;				else if (xScroll + rasterWidth &lt; treeDimensions[cursorY][cursorX].getRight() + entryGap)</b>
<b class="nc">&nbsp;					xScroll = treeDimensions[cursorY][cursorX].getRight() + entryGap - rasterWidth;</b>
&nbsp;
<b class="nc">&nbsp;				if (yScroll &gt; treeDimensions[cursorY][cursorX].getTop() - entryGap)</b>
<b class="nc">&nbsp;					yScroll = treeDimensions[cursorY][cursorX].getTop() - entryGap;</b>
<b class="nc">&nbsp;				else if (yScroll + rasterHeight &lt; treeDimensions[cursorY][cursorX].getBottom() + entryGap)</b>
<b class="nc">&nbsp;					yScroll = treeDimensions[cursorY][cursorX].getBottom() + entryGap - rasterHeight;</b>
&nbsp;			}
&nbsp;
&nbsp;			@Override
&nbsp;			public void render(Screen screen) {
<b class="nc">&nbsp;				super.render(screen);</b>
<b class="nc">&nbsp;				for (Menu menu : menus)</b>
<b class="nc">&nbsp;					menu.render(screen);</b>
<b class="nc">&nbsp;				Arrays.fill(rasterPixels, Color.BLACK);</b>
<b class="nc">&nbsp;				renderRaster();</b>
&nbsp;				// Border
<b class="nc">&nbsp;				screen.drawRect(rasterX - 1, rasterY - 1, rasterWidth + 2, rasterHeight + 2, Color.WHITE);</b>
<b class="nc">&nbsp;				screen.render(rasterX, rasterY, 0, 0, rasterWidth, rasterHeight, image);</b>
&nbsp;			}
&nbsp;
&nbsp;			private void renderRaster() {
<b class="nc">&nbsp;				if (questsTree.length == 0) {</b>
<b class="nc">&nbsp;					String text = Localization.getLocalized(&quot;minicraft.displays.quests.display.no_quest&quot;);</b>
<b class="nc">&nbsp;					Font.draw(text, simulatedRasterScreen, xScroll + rasterWidth / 2 - Font.textWidth(text) / 2,</b>
<b class="nc">&nbsp;						yScroll + rasterHeight / 2 - Font.textHeight() / 2, Color.GRAY);</b>
&nbsp;					return;
&nbsp;				}
&nbsp;
&nbsp;				// Tree relations.
<b class="nc">&nbsp;				for (int r = 0; r &lt; questsTree.length; r++) {</b>
<b class="nc">&nbsp;					for (int c = 0; c &lt; questsTree[r].length; c++) {</b>
<b class="nc">&nbsp;						Quest quest = questsTree[r][c];</b>
<b class="nc">&nbsp;						Quest parent = parents.get(quest);</b>
<b class="nc">&nbsp;						if (parent == null) continue;</b>
<b class="nc">&nbsp;						Rectangle rec = treeDimensions[r][c];</b>
<b class="nc">&nbsp;						Rectangle parentRec = null;</b>
<b class="nc">&nbsp;						int parentX = 0;</b>
<b class="nc">&nbsp;						int parentY = 0;</b>
<b class="nc">&nbsp;						for (int i = 0; i &lt; treeDimensions.length; i++) {</b>
<b class="nc">&nbsp;							for (int j = 0; j &lt; treeDimensions[i].length; j++) {</b>
<b class="nc">&nbsp;								if (questsTree[i][j] == parent) {</b>
<b class="nc">&nbsp;									parentRec = treeDimensions[i][j];</b>
<b class="nc">&nbsp;									parentX = j;</b>
<b class="nc">&nbsp;									parentY = i;</b>
<b class="nc">&nbsp;									break;</b>
&nbsp;								}
&nbsp;							}
&nbsp;						}
&nbsp;
<b class="nc">&nbsp;						if (parentRec == null) { // Unexpected.</b>
<b class="nc">&nbsp;							Logging.QUEST.warn(&quot;Unexpected situation: rectangle of parent quest not found.&quot;);</b>
<b class="nc">&nbsp;							continue;</b>
&nbsp;						}
&nbsp;
&nbsp;						// Parent is always higher than this.
<b class="nc">&nbsp;						Point p0 = parentRec.getCenter();</b>
<b class="nc">&nbsp;						Point p1 = rec.getCenter();</b>
<b class="nc">&nbsp;						int x0 = p0.x;</b>
<b class="nc">&nbsp;						int x1 = p1.x;</b>
<b class="nc">&nbsp;						int y0 = p0.y;</b>
<b class="nc">&nbsp;						int y1 = p1.y;</b>
<b class="nc">&nbsp;						boolean selected = c == cursorX &amp;&amp; r == cursorY;</b>
<b class="nc">&nbsp;						boolean parentSelected = parentX == cursorX &amp;&amp; parentY == cursorY;</b>
<b class="nc">&nbsp;						int color = selected ? Color.CYAN : parentSelected ? Color.GREEN : Color.tint(Color.GRAY, -1, true);</b>
&nbsp;
&nbsp;						// Bresenham&#39;s line algorithm
<b class="nc">&nbsp;						Rectangle finalParentRec = parentRec;</b>
<b class="nc">&nbsp;						plotLine(x0, y0, x1, y1, yy -&gt; yy &gt;= finalParentRec.getBottom() &amp;&amp; yy &lt;= rec.getTop(), color);</b>
&nbsp;					}
&nbsp;				}
&nbsp;
&nbsp;				// Tree elements.
<b class="nc">&nbsp;				for (int r = 0; r &lt; questsTree.length; r++) {</b>
<b class="nc">&nbsp;					for (int c = 0; c &lt; questsTree[r].length; c++) {</b>
<b class="nc">&nbsp;						Quest quest = questsTree[r][c];</b>
<b class="nc">&nbsp;						Rectangle rec = treeDimensions[r][c];</b>
<b class="nc">&nbsp;						int x = rec.getLeft();</b>
<b class="nc">&nbsp;						int y = rec.getTop();</b>
<b class="nc">&nbsp;						boolean selected = c == cursorX &amp;&amp; r == cursorY;</b>
<b class="nc">&nbsp;						Font.draw(Localization.getLocalized(quest.key), simulatedRasterScreen, x + entryPadding, y + entryPadding,</b>
<b class="nc">&nbsp;							selected ? (quest.isCompleted() ? Color.tint(Color.GREEN, 1, true) :</b>
<b class="nc">&nbsp;								Color.WHITE) : Color.tint(Color.GRAY, 1, true));</b>
<b class="nc">&nbsp;						for (int i = 0; i &lt; rec.getWidth(); i++) { // Border.</b>
<b class="nc">&nbsp;							for (int j = 0; j &lt; rec.getHeight(); j++) {</b>
<b class="nc">&nbsp;								if (i == 0 || i == rec.getWidth() - 1 || j == 0 || j == rec.getHeight() - 1)</b>
<b class="nc">&nbsp;									renderRasterPixel(x + i, y + j,</b>
<b class="nc">&nbsp;										selected ? (quest.isCompleted() ? Color.tint(Color.GREEN, -1, true) :</b>
<b class="nc">&nbsp;											Color.tint(Color.GRAY, 2, true)) : Color.GRAY);</b>
&nbsp;							}
&nbsp;						}
&nbsp;					}
&nbsp;				}
&nbsp;			}
&nbsp;
&nbsp;			private void renderRasterPixel(int x, int y, int color) {
<b class="nc">&nbsp;				x -= xScroll;</b>
<b class="nc">&nbsp;				y -= yScroll;</b>
<b class="nc">&nbsp;				if (x &lt; 0 || x &gt;= rasterWidth || y &lt; 0 || y &gt;= rasterHeight) return; // Out of bounds.</b>
<b class="nc">&nbsp;				rasterPixels[x + y * rasterWidth] = color;</b>
&nbsp;			}
&nbsp;
&nbsp;			// Parts of Bresenham&#39;s line algorithm
&nbsp;			void plotLineLow(int x0, int y0, int x1, int y1, IntPredicate yRange, int color) {
<b class="nc">&nbsp;				int dx = x1 - x0;</b>
<b class="nc">&nbsp;				int dy = y1 - y0;</b>
<b class="nc">&nbsp;				int yi = 1;</b>
<b class="nc">&nbsp;				if (dy &lt; 0) {</b>
<b class="nc">&nbsp;					yi = -1;</b>
<b class="nc">&nbsp;					dy = -dy;</b>
&nbsp;				}
<b class="nc">&nbsp;				int D = (2 * dy) - dx;</b>
<b class="nc">&nbsp;				int y = y0;</b>
&nbsp;
<b class="nc">&nbsp;				for (int x = x0; x &lt;= x1; x++) {</b>
<b class="nc">&nbsp;					if (yRange.test(y)) renderRasterPixel(x, y, color);</b>
<b class="nc">&nbsp;					if (D &gt; 0) {</b>
<b class="nc">&nbsp;						y = y + yi;</b>
<b class="nc">&nbsp;						D = D + (2 * (dy - dx));</b>
&nbsp;					} else
<b class="nc">&nbsp;						D = D + 2 * dy;</b>
&nbsp;				}
&nbsp;			}
&nbsp;
&nbsp;			void plotLineHigh(int x0, int y0, int x1, int y1, IntPredicate yRange, int color) {
<b class="nc">&nbsp;				int dx = x1 - x0;</b>
<b class="nc">&nbsp;				int dy = y1 - y0;</b>
<b class="nc">&nbsp;				int xi = 1;</b>
<b class="nc">&nbsp;				if (dx &lt; 0) {</b>
<b class="nc">&nbsp;					xi = -1;</b>
<b class="nc">&nbsp;					dx = -dx;</b>
&nbsp;				}
<b class="nc">&nbsp;				int D = (2 * dx) - dy;</b>
<b class="nc">&nbsp;				int x = x0;</b>
&nbsp;
<b class="nc">&nbsp;				for (int y = y0; y &lt;= y1; y++) {</b>
<b class="nc">&nbsp;					if (yRange.test(y)) renderRasterPixel(x, y, color);</b>
<b class="nc">&nbsp;					if (D &gt; 0) {</b>
<b class="nc">&nbsp;						x = x + xi;</b>
<b class="nc">&nbsp;						D = D + (2 * (dx - dy));</b>
&nbsp;					} else
<b class="nc">&nbsp;						D = D + 2 * dx;</b>
&nbsp;				}
&nbsp;			}
&nbsp;
&nbsp;			void plotLine(int x0, int y0, int x1, int y1, IntPredicate yRange, int color) {
<b class="nc">&nbsp;				if (Math.abs(y1 - y0) &lt; Math.abs(x1 - x0)) {</b>
<b class="nc">&nbsp;					if (x0 &gt; x1)</b>
<b class="nc">&nbsp;						plotLineLow(x1, y1, x0, y0, yRange, color);</b>
&nbsp;					else
<b class="nc">&nbsp;						plotLineLow(x0, y0, x1, y1, yRange, color);</b>
&nbsp;				} else {
<b class="nc">&nbsp;					if (y0 &gt; y1)</b>
<b class="nc">&nbsp;						plotLineHigh(x1, y1, x0, y0, yRange, color);</b>
&nbsp;					else
<b class="nc">&nbsp;						plotLineHigh(x0, y0, x1, y1, yRange, color);</b>
&nbsp;				}
&nbsp;			}
&nbsp;
&nbsp;			private static class QuestInformationDisplay extends Display {
&nbsp;				public QuestInformationDisplay(Quest quest) {
<b class="nc">&nbsp;					super(false, true);</b>
<b class="nc">&nbsp;					String state = quest.isCompleted() ? &quot;minicraft.displays.quests.quest_info.display.status.completed&quot; :</b>
<b class="nc">&nbsp;						quest.isUnlocked() ? &quot;minicraft.displays.quests.quest_info.display.status.unlocked&quot; :</b>
<b class="nc">&nbsp;							&quot;minicraft.displays.quests.quest_info.display.status.locked&quot;;</b>
<b class="nc">&nbsp;					int color = quest.isCompleted() ? Color.GREEN : quest.isUnlocked() ? Color.WHITE : Color.GRAY;</b>
<b class="nc">&nbsp;					menus = new Menu[] {</b>
&nbsp;						new Menu.Builder(true, 1, RelPos.CENTER)
<b class="nc">&nbsp;							.setPositioning(new Point(Screen.w / 2, 5), RelPos.BOTTOM)</b>
<b class="nc">&nbsp;							.setEntries(new StringEntry(quest.getSeries().key),</b>
<b class="nc">&nbsp;								new StringEntry(Localization.getLocalized(quest.key) + &quot;: &quot; + Localization.getLocalized(state), color, false),</b>
<b class="nc">&nbsp;								new StringEntry(quest.shouldAllCriteriaBeCompleted() ?</b>
<b class="nc">&nbsp;									Localization.getLocalized(&quot;minicraft.displays.quests.quest_info.display.progress&quot;,</b>
<b class="nc">&nbsp;										quest.getNumCriteriaCompleted(), quest.getTotalNumCriteria()) :</b>
<b class="nc">&nbsp;									Localization.getLocalized(&quot;minicraft.displays.quests.quest_info.display.progress_uncompleted&quot;), Color.WHITE, false))</b>
<b class="nc">&nbsp;							.setSelectable(false)</b>
<b class="nc">&nbsp;							.createMenu(),</b>
&nbsp;						new Menu.Builder(true, 2, RelPos.CENTER,
<b class="nc">&nbsp;							StringEntry.useLines(quest.description))</b>
<b class="nc">&nbsp;							.setPositioning(new Point(Screen.w / 2, 52), RelPos.BOTTOM)</b>
<b class="nc">&nbsp;							.setSelectable(false)</b>
<b class="nc">&nbsp;							.createMenu()</b>
&nbsp;					};
&nbsp;				}
&nbsp;			}
&nbsp;		}
&nbsp;	}
&nbsp;
&nbsp;	public static HashSet&lt;Quest&gt; getDisplayableQuests() {
<b class="nc">&nbsp;		return new HashSet&lt;&gt;(displayableQuests);</b>
&nbsp;	}
&nbsp;
&nbsp;	public static void resetGameQuests() {
<b class="nc">&nbsp;		resetGameQuests(true);</b>
&nbsp;	}
&nbsp;
&nbsp;	private static void resetGameQuests(boolean update) {
<b class="nc">&nbsp;		series.forEach(AdvancementElement::reset);</b>
<b class="nc">&nbsp;		if (update) refreshDisplayableQuests();</b>
&nbsp;	}
&nbsp;
&nbsp;	public static void load(JSONObject json) {
<b class="nc">&nbsp;		resetGameQuests(false);</b>
<b class="nc">&nbsp;		for (String k : json.keySet()) {</b>
<b class="nc">&nbsp;			series.forEach(series1 -&gt; {</b>
<b class="nc">&nbsp;				if (series1.key.equals(k)) {</b>
<b class="nc">&nbsp;					series1.load(json.getJSONObject(k));</b>
&nbsp;				} else {
<b class="nc">&nbsp;					series1.getSeriesQuests().forEach((key, value) -&gt; {</b>
<b class="nc">&nbsp;						if (key.equals(k))</b>
<b class="nc">&nbsp;							value.load(json.getJSONObject(k));</b>
&nbsp;					});
&nbsp;				}
&nbsp;			});
<b class="nc">&nbsp;		}</b>
<b class="nc">&nbsp;		refreshDisplayableQuests();</b>
&nbsp;	}
&nbsp;
&nbsp;	/**
&nbsp;	 * Saving and writing all data into the given JSONObject.
&nbsp;	 */
&nbsp;	public static void save(JSONObject json) {
<b class="nc">&nbsp;		series.forEach(series1 -&gt; {</b>
<b class="nc">&nbsp;			series1.save(json);</b>
<b class="nc">&nbsp;			series1.getSeriesQuests().values().forEach(quest -&gt; quest.save(json));</b>
&nbsp;		});
&nbsp;	}
&nbsp;
&nbsp;	@Override
&nbsp;	public void tick(InputHandler input) {
<b class="nc">&nbsp;		super.tick(input);</b>
&nbsp;
<b class="nc">&nbsp;		if (input.inputPressed(&quot;cursor-left&quot;)) if (selectedEntry &gt; 0) {</b>
<b class="nc">&nbsp;			selectedEntry--;</b>
<b class="nc">&nbsp;			updateEntries();</b>
&nbsp;		}
&nbsp;
<b class="nc">&nbsp;		if (input.inputPressed(&quot;cursor-right&quot;)) if (selectedEntry &lt; 1) {</b>
<b class="nc">&nbsp;			selectedEntry++;</b>
<b class="nc">&nbsp;			updateEntries();</b>
&nbsp;		}
&nbsp;
<b class="nc">&nbsp;		if (menus[0].getCurEntry() != null) {</b>
<b class="nc">&nbsp;			menus[3].setEntries(StringEntry.useLines(entrySeries[selectedEntry][menus[0].getSelection()].description));</b>
&nbsp;		} else {
<b class="nc">&nbsp;			menus[3].setEntries(StringEntry.useLines(&quot;minicraft.displays.quests.display.no_quest_desc&quot;));</b>
&nbsp;		}
&nbsp;	}
&nbsp;
&nbsp;	private void updateEntries() {
<b class="nc">&nbsp;		menus[0].setEntries(seriesEntries[selectedEntry]);</b>
&nbsp;
<b class="nc">&nbsp;		String[] entryNames = new String[] {</b>
&nbsp;			&quot;minicraft.displays.quests.display.header.unlocked&quot;, &quot;minicraft.displays.quests.display.header.completed&quot;
&nbsp;		};
&nbsp;
<b class="nc">&nbsp;		for (int i = 0; i &lt; 2; i++) {</b>
<b class="nc">&nbsp;			menus[i + 1].updateEntry(0, new StringEntry(entryNames[i], (i == selectedEntry) ? Color.WHITE : Color.GRAY));</b>
&nbsp;		}
&nbsp;
<b class="nc">&nbsp;		int select = previousSelection;</b>
<b class="nc">&nbsp;		previousSelection = menus[0].getSelection();</b>
<b class="nc">&nbsp;		menus[0].setSelection(select);</b>
&nbsp;	}
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2024-04-18 20:02</div>
</div>
</body>
</html>
