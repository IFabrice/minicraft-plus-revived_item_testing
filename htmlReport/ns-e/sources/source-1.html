


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>Coverage Report > LegacyLoad</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">minicraft.saveload</a>
</div>

<h1>Coverage Summary for Class: LegacyLoad (minicraft.saveload)</h1>

<table class="coverageStats">
<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Class, %
</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">LegacyLoad</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/14)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/263)
  </span>
</td>
</tr>

</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package minicraft.saveload;
&nbsp;
&nbsp;import minicraft.core.Game;
&nbsp;import minicraft.core.Updater;
&nbsp;import minicraft.core.World;
&nbsp;import minicraft.core.io.Settings;
&nbsp;import minicraft.entity.Entity;
&nbsp;import minicraft.entity.furniture.Bed;
&nbsp;import minicraft.entity.furniture.Chest;
&nbsp;import minicraft.entity.furniture.Crafter;
&nbsp;import minicraft.entity.furniture.DeathChest;
&nbsp;import minicraft.entity.furniture.DungeonChest;
&nbsp;import minicraft.entity.furniture.Lantern;
&nbsp;import minicraft.entity.furniture.Spawner;
&nbsp;import minicraft.entity.furniture.Tnt;
&nbsp;import minicraft.entity.mob.AirWizard;
&nbsp;import minicraft.entity.mob.Cow;
&nbsp;import minicraft.entity.mob.Creeper;
&nbsp;import minicraft.entity.mob.Knight;
&nbsp;import minicraft.entity.mob.Mob;
&nbsp;import minicraft.entity.mob.MobAi;
&nbsp;import minicraft.entity.mob.Pig;
&nbsp;import minicraft.entity.mob.Player;
&nbsp;import minicraft.entity.mob.Sheep;
&nbsp;import minicraft.entity.mob.Skeleton;
&nbsp;import minicraft.entity.mob.Slime;
&nbsp;import minicraft.entity.mob.Snake;
&nbsp;import minicraft.entity.mob.Zombie;
&nbsp;import minicraft.item.ArmorItem;
&nbsp;import minicraft.item.Inventory;
&nbsp;import minicraft.item.Item;
&nbsp;import minicraft.item.Items;
&nbsp;import minicraft.item.PotionItem;
&nbsp;import minicraft.item.PotionType;
&nbsp;import minicraft.item.StackableItem;
&nbsp;import minicraft.level.Level;
&nbsp;import minicraft.level.tile.Tiles;
&nbsp;import minicraft.screen.LoadingDisplay;
&nbsp;import minicraft.util.Logging;
&nbsp;import org.tinylog.Logger;
&nbsp;
&nbsp;import java.io.BufferedReader;
&nbsp;import java.io.File;
&nbsp;import java.io.FileReader;
&nbsp;import java.io.IOException;
&nbsp;import java.util.ArrayList;
&nbsp;import java.util.Arrays;
&nbsp;import java.util.List;
&nbsp;
&nbsp;/// This class is simply a way to seperate all the old, compatibility complications into a seperate file.
&nbsp;public class LegacyLoad {
&nbsp;
<b class="nc">&nbsp;	String location = Game.gameDir;</b>
&nbsp;
<b class="nc">&nbsp;	private static final String extension = Save.extension;</b>
&nbsp;
&nbsp;	ArrayList&lt;String&gt; data;
&nbsp;	ArrayList&lt;String&gt; extradata;
&nbsp;
&nbsp;	public boolean hasloadedbigworldalready;
&nbsp;	Version currentVer, worldVer;
<b class="nc">&nbsp;	boolean oldSave = false;</b>
&nbsp;
<b class="nc">&nbsp;	Game game = null;</b>
&nbsp;
&nbsp;	private DeathChest deathChest;
&nbsp;
&nbsp;	{
<b class="nc">&nbsp;		currentVer = Game.VERSION;</b>
<b class="nc">&nbsp;		worldVer = null;</b>
&nbsp;
<b class="nc">&nbsp;		data = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;		extradata = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;		hasloadedbigworldalready = false;</b>
&nbsp;	}
&nbsp;
<b class="nc">&nbsp;	public LegacyLoad(String worldname) {</b>
<b class="nc">&nbsp;		location += &quot;/saves/&quot; + worldname + &quot;/&quot;;</b>
&nbsp;
<b class="nc">&nbsp;		File testFile = new File(location + &quot;KeyPrefs&quot; + extension);</b>
<b class="nc">&nbsp;		if (!testFile.exists()) {</b>
<b class="nc">&nbsp;			worldVer = new Version(&quot;1.8&quot;);</b>
<b class="nc">&nbsp;			oldSave = true;</b>
&nbsp;		} else
<b class="nc">&nbsp;			testFile.delete(); // We don&#39;t care about it anymore anyway.</b>
&nbsp;
&nbsp;		// This is used in loadInventory().
&nbsp;
<b class="nc">&nbsp;		loadGame(&quot;Game&quot;); // More of the version will be determined here</b>
<b class="nc">&nbsp;		loadWorld(&quot;Level&quot;);</b>
<b class="nc">&nbsp;		loadPlayer(&quot;Player&quot;, Game.player);</b>
<b class="nc">&nbsp;		loadInventory(&quot;Inventory&quot;, Game.player.getInventory());</b>
<b class="nc">&nbsp;		loadEntities(&quot;Entities&quot;, Game.player);</b>
<b class="nc">&nbsp;		LoadingDisplay.setPercentage(0); // reset</b>
&nbsp;
<b class="nc">&nbsp;		if (deathChest != null &amp;&amp; deathChest.getInventory().invSize() &gt; 0) {</b>
<b class="nc">&nbsp;			Game.player.getLevel().add(deathChest, Game.player.x, Game.player.y);</b>
<b class="nc">&nbsp;			Logging.SAVELOAD.debug(&quot;Added DeathChest which contains exceed items.&quot;);</b>
&nbsp;		}
&nbsp;	}
&nbsp;
<b class="nc">&nbsp;	protected LegacyLoad(File unlocksFile) {</b>
<b class="nc">&nbsp;		updateUnlocks(unlocksFile);</b>
&nbsp;	}
&nbsp;
&nbsp;	public void loadFromFile(String filename) {
<b class="nc">&nbsp;		data.clear();</b>
<b class="nc">&nbsp;		extradata.clear();</b>
<b class="nc">&nbsp;		BufferedReader br = null;</b>
<b class="nc">&nbsp;		BufferedReader br2 = null;</b>
&nbsp;
&nbsp;		try {
<b class="nc">&nbsp;			br = new BufferedReader(new FileReader(filename));</b>
&nbsp;
&nbsp;			String curLine;
<b class="nc">&nbsp;			StringBuilder total = new StringBuilder();</b>
&nbsp;			ArrayList&lt;String&gt; curData;
<b class="nc">&nbsp;			while ((curLine = br.readLine()) != null)</b>
<b class="nc">&nbsp;				total.append(curLine);</b>
<b class="nc">&nbsp;			data.addAll(Arrays.asList(total.toString().split(&quot;,&quot;)));</b>
&nbsp;
<b class="nc">&nbsp;			if (filename.contains(&quot;Level&quot;)) {</b>
<b class="nc">&nbsp;				total = new StringBuilder();</b>
<b class="nc">&nbsp;				br2 = new BufferedReader(new FileReader(filename.substring(0, filename.lastIndexOf(&quot;/&quot;) + 7) + &quot;data&quot; + extension));</b>
&nbsp;
<b class="nc">&nbsp;				while ((curLine = br2.readLine()) != null)</b>
<b class="nc">&nbsp;					total.append(curLine);</b>
<b class="nc">&nbsp;				extradata.addAll(Arrays.asList(total.toString().split(&quot;,&quot;)));</b>
&nbsp;			}
<b class="nc">&nbsp;		} catch (IOException ex) {</b>
<b class="nc">&nbsp;			ex.printStackTrace();</b>
&nbsp;		} finally {
<b class="nc">&nbsp;			try {</b>
<b class="nc">&nbsp;				LoadingDisplay.progress(13);</b>
<b class="nc">&nbsp;				if (LoadingDisplay.getPercentage() &gt; 100) {</b>
<b class="nc">&nbsp;					LoadingDisplay.setPercentage(100);</b>
&nbsp;				}
&nbsp;
<b class="nc">&nbsp;				if (br != null) {</b>
<b class="nc">&nbsp;					br.close();</b>
&nbsp;				}
&nbsp;
<b class="nc">&nbsp;				if (br2 != null) {</b>
<b class="nc">&nbsp;					br2.close();</b>
&nbsp;				}
<b class="nc">&nbsp;			} catch (IOException ex) {</b>
<b class="nc">&nbsp;				ex.printStackTrace();</b>
<b class="nc">&nbsp;			}</b>
&nbsp;
<b class="nc">&nbsp;		}</b>
&nbsp;	}
&nbsp;
&nbsp;	protected void updateUnlocks(File file) {
<b class="nc">&nbsp;		String path = file.getPath();</b>
<b class="nc">&nbsp;		loadFromFile(path);</b>
&nbsp;
<b class="nc">&nbsp;		for (int i = 0; i &lt; data.size(); i++) {</b>
<b class="nc">&nbsp;			if (data.get(i).length() == 0) {</b>
<b class="nc">&nbsp;				data.remove(i);</b>
<b class="nc">&nbsp;				i--;</b>
<b class="nc">&nbsp;				continue;</b>
&nbsp;			}
<b class="nc">&nbsp;			data.set(i, data.get(i).replace(&quot;HOURMODE&quot;, &quot;H_ScoreTime&quot;).replace(&quot;MINUTEMODE&quot;, &quot;M_ScoreTime&quot;));</b>
&nbsp;		}
&nbsp;
<b class="nc">&nbsp;		file.delete();</b>
&nbsp;
&nbsp;		try {
<b class="nc">&nbsp;			java.io.BufferedWriter writer = new java.io.BufferedWriter(new java.io.FileWriter(path));</b>
<b class="nc">&nbsp;			for (String unlock : data) {</b>
<b class="nc">&nbsp;				writer.write(&quot;,&quot; + unlock);</b>
<b class="nc">&nbsp;			}</b>
<b class="nc">&nbsp;			writer.flush();</b>
<b class="nc">&nbsp;			writer.close();</b>
<b class="nc">&nbsp;		} catch (IOException ex) {</b>
<b class="nc">&nbsp;			ex.printStackTrace();</b>
<b class="nc">&nbsp;		}</b>
&nbsp;	}
&nbsp;
<b class="nc">&nbsp;	private int playerac = 0; // This is a temp storage var for use to restore player arrow count.</b>
&nbsp;
&nbsp;	public void loadGame(String filename) {
<b class="nc">&nbsp;		loadFromFile(location + filename + extension);</b>
<b class="nc">&nbsp;		boolean hasVersion = data.get(0).contains(&quot;.&quot;);</b>
<b class="nc">&nbsp;		if (hasVersion) {</b>
<b class="nc">&nbsp;			worldVer = new Version(data.get(0)); // Gets the world version</b>
<b class="nc">&nbsp;			Updater.setTime(Integer.parseInt(data.get(1)));</b>
<b class="nc">&nbsp;			Updater.gameTime = 65000; // Prevents time cheating.</b>
&nbsp;
<b class="nc">&nbsp;			if (worldVer.compareTo(new Version(&quot;1.9.2&quot;)) &lt; 0) {</b>
<b class="nc">&nbsp;				Settings.set(&quot;autosave&quot;, Boolean.parseBoolean(data.get(3)));</b>
<b class="nc">&nbsp;				Settings.set(&quot;sound&quot;, Boolean.parseBoolean(data.get(4)));</b>
<b class="nc">&nbsp;				if (worldVer.compareTo(new Version(&quot;1.9.2-dev2&quot;)) &gt;= 0)</b>
<b class="nc">&nbsp;					AirWizard.beaten = Boolean.parseBoolean(data.get(5));</b>
&nbsp;			} else { // This is 1.9.2 official or after
<b class="nc">&nbsp;				Settings.setIdx(&quot;diff&quot;, Integer.parseInt(data.get(3)));</b>
<b class="nc">&nbsp;				AirWizard.beaten = Boolean.parseBoolean(data.get(4));</b>
&nbsp;			}
&nbsp;		} else {
<b class="nc">&nbsp;			if (data.size() == 5) {</b>
<b class="nc">&nbsp;				worldVer = new Version(&quot;1.9&quot;);</b>
<b class="nc">&nbsp;				Updater.setTime(Integer.parseInt(data.get(0)));</b>
<b class="nc">&nbsp;				Settings.set(&quot;autosave&quot;, Boolean.parseBoolean(data.get(3)));</b>
<b class="nc">&nbsp;				Settings.set(&quot;sound&quot;, Boolean.parseBoolean(data.get(4)));</b>
&nbsp;			} else { // version == 1.8?
<b class="nc">&nbsp;				if (!oldSave) {</b>
<b class="nc">&nbsp;					Logging.SAVELOAD.warn(&quot;UNEXPECTED WORLD VERSION&quot;);</b>
<b class="nc">&nbsp;					worldVer = new Version(&quot;1.8.1&quot;);</b>
&nbsp;				}
&nbsp;				// For backwards compatibility
<b class="nc">&nbsp;				Updater.tickCount = Integer.parseInt(data.get(0));</b>
<b class="nc">&nbsp;				playerac = Integer.parseInt(data.get(3));</b>
<b class="nc">&nbsp;				Settings.set(&quot;autosave&quot;, false);</b>
&nbsp;			}
&nbsp;		}
&nbsp;	}
&nbsp;
&nbsp;	public void loadWorld(String filename) {
<b class="nc">&nbsp;		for (int l = 0; l &lt; World.levels.length; l++) {</b>
<b class="nc">&nbsp;			loadFromFile(location + filename + l + extension);</b>
&nbsp;
<b class="nc">&nbsp;			int lvlw = Integer.parseInt(data.get(0));</b>
<b class="nc">&nbsp;			int lvlh = Integer.parseInt(data.get(1));</b>
<b class="nc">&nbsp;			int lvldepth = Integer.parseInt(data.get(2));</b>
<b class="nc">&nbsp;			Settings.set(&quot;size&quot;, lvlw);</b>
&nbsp;
<b class="nc">&nbsp;			short[] tiles = new short[lvlw * lvlh];</b>
<b class="nc">&nbsp;			short[] tdata = new short[lvlw * lvlh];</b>
&nbsp;
<b class="nc">&nbsp;			for (int x = 0; x &lt; lvlw - 1; x++) {</b>
<b class="nc">&nbsp;				for (int y = 0; y &lt; lvlh - 1; y++) {</b>
<b class="nc">&nbsp;					int tileArrIdx = y + x * lvlw;</b>
<b class="nc">&nbsp;					int tileidx = x + y * lvlw; // The tiles are saved with x outer loop, and y inner loop, meaning that the list reads down, then right one, rather than right, then down one.</b>
<b class="nc">&nbsp;					Load.loadTile(tiles, tdata, tileArrIdx, Tiles.oldids.get(Integer.parseInt(data.get(tileidx + 3))),</b>
<b class="nc">&nbsp;						extradata.get(tileidx));</b>
&nbsp;				}
&nbsp;			}
&nbsp;
<b class="nc">&nbsp;			World.levels[l] = new Level(lvlw, lvlh, lvldepth, null, false);</b>
<b class="nc">&nbsp;			World.levels[l].tiles = tiles;</b>
<b class="nc">&nbsp;			World.levels[l].data = tdata;</b>
&nbsp;		}
&nbsp;	}
&nbsp;
&nbsp;	public void loadPlayer(String filename, Player player) {
<b class="nc">&nbsp;		loadFromFile(location + filename + extension);</b>
<b class="nc">&nbsp;		player.x = Integer.parseInt(data.get(0));</b>
<b class="nc">&nbsp;		player.y = Integer.parseInt(data.get(1));</b>
<b class="nc">&nbsp;		player.spawnx = Integer.parseInt(data.get(2));</b>
<b class="nc">&nbsp;		player.spawny = Integer.parseInt(data.get(3));</b>
<b class="nc">&nbsp;		player.health = Integer.parseInt(data.get(4));</b>
<b class="nc">&nbsp;		player.armor = Integer.parseInt(data.get(5));</b>
&nbsp;
&nbsp;		String modedata;
<b class="nc">&nbsp;		if (!oldSave) {</b>
<b class="nc">&nbsp;			if (data.size() &gt;= 14) {</b>
<b class="nc">&nbsp;				if (worldVer == null) worldVer = new Version(&quot;1.9.1-pre1&quot;);</b>
<b class="nc">&nbsp;				player.armorDamageBuffer = Integer.parseInt(data.get(13));</b>
<b class="nc">&nbsp;				player.curArmor = (ArmorItem) Items.get(data.get(14));</b>
<b class="nc">&nbsp;			} else player.armor = 0;</b>
&nbsp;
<b class="nc">&nbsp;			Game.currentLevel = Integer.parseInt(data.get(8));</b>
<b class="nc">&nbsp;			modedata = data.get(9);</b>
&nbsp;
&nbsp;		} else {
&nbsp;			// Old, 1.8 save.
<b class="nc">&nbsp;			Game.currentLevel = Integer.parseInt(data.get(7));</b>
<b class="nc">&nbsp;			modedata = data.get(8);</b>
&nbsp;		}
&nbsp;
<b class="nc">&nbsp;		player.setScore(Integer.parseInt(data.get(6)));</b>
<b class="nc">&nbsp;		World.levels[Game.currentLevel].add(player);</b>
&nbsp;
&nbsp;		int mode;
<b class="nc">&nbsp;		if (modedata.contains(&quot;;&quot;)) {</b>
<b class="nc">&nbsp;			mode = Integer.parseInt(modedata.substring(0, modedata.indexOf(&quot;;&quot;)));</b>
<b class="nc">&nbsp;			if (mode == 4)</b>
<b class="nc">&nbsp;				Updater.scoreTime = Integer.parseInt(modedata.substring(modedata.indexOf(&quot;;&quot;) + 1));</b>
&nbsp;		} else {
<b class="nc">&nbsp;			mode = Integer.parseInt(modedata);</b>
<b class="nc">&nbsp;			if (mode == 4) Updater.scoreTime = 300;</b>
&nbsp;		}
&nbsp;
<b class="nc">&nbsp;		Settings.setIdx(&quot;mode&quot;, mode);</b>
&nbsp;
&nbsp;		boolean hasEffects;
<b class="nc">&nbsp;		int potionIdx = 10;</b>
<b class="nc">&nbsp;		if (oldSave) {</b>
<b class="nc">&nbsp;			hasEffects = data.size() &gt; 10 &amp;&amp; data.get(data.size() - 2).contains(&quot;PotionEffects[&quot;);</b>
<b class="nc">&nbsp;			potionIdx = data.size() - 2;</b>
&nbsp;		} else
<b class="nc">&nbsp;			hasEffects = !data.get(10).equals(&quot;PotionEffects[]&quot;); // Newer save</b>
&nbsp;
<b class="nc">&nbsp;		if (hasEffects) {</b>
<b class="nc">&nbsp;			String[] effects = data.get(potionIdx).replace(&quot;PotionEffects[&quot;, &quot;&quot;).replace(&quot;]&quot;, &quot;&quot;).split(&quot;:&quot;);</b>
&nbsp;
<b class="nc">&nbsp;			for (int i = 0; i &lt; effects.length; i++) {</b>
<b class="nc">&nbsp;				String[] effect = effects[i].split(&quot;;&quot;);</b>
<b class="nc">&nbsp;				String pName = effect[0];</b>
<b class="nc">&nbsp;				if (oldSave) pName = pName.replace(&quot;P.&quot;, &quot;Potion&quot;);</b>
<b class="nc">&nbsp;				PotionItem.applyPotion(player, Enum.valueOf(PotionType.class, pName), Integer.parseInt(effect[1]));</b>
&nbsp;			}
&nbsp;		}
&nbsp;
<b class="nc">&nbsp;		String colors = data.get(oldSave ? data.size() - 1 : 11).replace(&quot;[&quot;, &quot;&quot;).replace(&quot;]&quot;, &quot;&quot;);</b>
<b class="nc">&nbsp;		String[] color = colors.split(&quot;;&quot;);</b>
<b class="nc">&nbsp;		player.shirtColor = Integer.parseInt(color[0] + color[1] + color[2]);</b>
&nbsp;	}
&nbsp;
&nbsp;	public void loadInventory(String filename, Inventory inventory) {
<b class="nc">&nbsp;		deathChest = new DeathChest();</b>
<b class="nc">&nbsp;		loadFromFile(location + filename + extension);</b>
<b class="nc">&nbsp;		inventory.clearInv();</b>
&nbsp;
<b class="nc">&nbsp;		for (int i = 0; i &lt; data.size(); i++) {</b>
<b class="nc">&nbsp;			String item = data.get(i);</b>
<b class="nc">&nbsp;			if (i == 0 &amp;&amp; oldSave &amp;&amp; item.contains(&quot;;&quot;)) item = item.replace(&quot;;0&quot;, &quot;;1&quot;);</b>
<b class="nc">&nbsp;			loadItemToInventory(item, inventory);</b>
&nbsp;		}
&nbsp;
<b class="nc">&nbsp;		if (playerac &gt; 0 &amp;&amp; inventory == Game.player.getInventory()) {</b>
<b class="nc">&nbsp;			for (int i = 0; i &lt; playerac; i++)</b>
<b class="nc">&nbsp;				loadItem(inventory, Items.get(&quot;arrow&quot;));</b>
<b class="nc">&nbsp;			playerac = 0;</b>
&nbsp;		}
&nbsp;	}
&nbsp;
&nbsp;	public void loadItemToInventory(String item, Inventory inventory) {
<b class="nc">&nbsp;		if (item.contains(&quot;;&quot;)) {</b>
<b class="nc">&nbsp;			String[] curData = item.split(&quot;;&quot;);</b>
<b class="nc">&nbsp;			String itemName = curData[0];</b>
<b class="nc">&nbsp;			if (oldSave) itemName = subOldName(itemName);</b>
&nbsp;
&nbsp;			//System.out.println(&quot;Item to fetch: &quot; + itemName + &quot;; count=&quot; + curData[1]);
<b class="nc">&nbsp;			Item newItem = Items.get(itemName);</b>
<b class="nc">&nbsp;			int count = Integer.parseInt(curData[1]);</b>
<b class="nc">&nbsp;			for (int i = 0; i &lt; count; i++)</b>
<b class="nc">&nbsp;				loadItem(inventory, newItem);</b>
<b class="nc">&nbsp;		} else {</b>
<b class="nc">&nbsp;			if (oldSave) item = subOldName(item);</b>
<b class="nc">&nbsp;			Item toAdd = Items.get(item);</b>
<b class="nc">&nbsp;			loadItem(inventory, toAdd);</b>
&nbsp;		}
&nbsp;	}
&nbsp;
&nbsp;	private void loadItem(Inventory inventory, Item item) {
<b class="nc">&nbsp;		int total = 1;</b>
<b class="nc">&nbsp;		if (item instanceof StackableItem) total = ((StackableItem) item).count;</b>
<b class="nc">&nbsp;		int loaded = inventory.add(item);</b>
&nbsp;
<b class="nc">&nbsp;		if (loaded &lt; total) {</b>
<b class="nc">&nbsp;			deathChest.getInventory().add(item.copy());</b>
&nbsp;		}
&nbsp;	}
&nbsp;
&nbsp;	private String subOldName(String oldName) {
&nbsp;		//System.out.println(&quot;Old name: &quot; + oldName);
<b class="nc">&nbsp;		String newName = oldName.replace(&quot;P.&quot;, &quot;Potion&quot;).replace(&quot;Fish Rod&quot;, &quot;Fishing Rod&quot;).replace(&quot;bed&quot;, &quot;Bed&quot;);</b>
<b class="nc">&nbsp;		newName = Load.subOldName(newName, worldVer);</b>
&nbsp;		//System.out.println(&quot;New name: &quot; + newName);
<b class="nc">&nbsp;		return newName;</b>
&nbsp;	}
&nbsp;
&nbsp;	public void loadEntities(String filename, Player player) {
<b class="nc">&nbsp;		loadFromFile(location + filename + extension);</b>
&nbsp;
<b class="nc">&nbsp;		for (int i = 0; i &lt; World.levels.length; i++) {</b>
<b class="nc">&nbsp;			World.levels[i].clearEntities();</b>
&nbsp;		}
&nbsp;
<b class="nc">&nbsp;		for (int i = 0; i &lt; data.size(); i++) {</b>
<b class="nc">&nbsp;			List&lt;String&gt; info = Arrays.asList(data.get(i).substring(data.get(i).indexOf(&quot;[&quot;) + 1, data.get(i).indexOf(&quot;]&quot;)).split(&quot;:&quot;)); // This gets everything inside the &quot;[...]&quot; after the entity name.</b>
&nbsp;
<b class="nc">&nbsp;			String entityName = data.get(i).substring(0, data.get(i).indexOf(&quot;[&quot;)).replace(&quot;bed&quot;, &quot;Bed&quot;).replace(&quot;II&quot;, &quot;&quot;); // This gets the text before &quot;[&quot;, which is the entity name.</b>
<b class="nc">&nbsp;			int x = Integer.parseInt(info.get(0));</b>
<b class="nc">&nbsp;			int y = Integer.parseInt(info.get(1));</b>
&nbsp;
<b class="nc">&nbsp;			int mobLvl = 0;</b>
&nbsp;			try {
<b class="nc">&nbsp;				if (Class.forName(&quot;EnemyMob&quot;).isAssignableFrom(Class.forName(entityName)))</b>
<b class="nc">&nbsp;					mobLvl = Integer.parseInt(info.get(info.size() - 2));</b>
<b class="nc">&nbsp;			} catch (ClassNotFoundException ignored) {</b>
<b class="nc">&nbsp;			}</b>
&nbsp;
<b class="nc">&nbsp;			Entity newEntity = getEntity(entityName, player, mobLvl);</b>
&nbsp;
<b class="nc">&nbsp;			if (newEntity != null) { // the method never returns null, but...</b>
&nbsp;				int currentlevel;
<b class="nc">&nbsp;				if (newEntity instanceof Mob) {</b>
<b class="nc">&nbsp;					Mob mob = (Mob) newEntity;</b>
<b class="nc">&nbsp;					mob.health = Integer.parseInt(info.get(2));</b>
<b class="nc">&nbsp;					currentlevel = Integer.parseInt(info.get(info.size() - 1));</b>
<b class="nc">&nbsp;					World.levels[currentlevel].add(mob, x, y);</b>
<b class="nc">&nbsp;				} else if (newEntity instanceof Chest) {</b>
<b class="nc">&nbsp;					Chest chest = (Chest) newEntity;</b>
<b class="nc">&nbsp;					boolean isDeathChest = chest instanceof DeathChest;</b>
<b class="nc">&nbsp;					boolean isDungeonChest = chest instanceof DungeonChest;</b>
<b class="nc">&nbsp;					List&lt;String&gt; chestInfo = info.subList(2, info.size() - 1);</b>
&nbsp;
<b class="nc">&nbsp;					int endIdx = chestInfo.size() - (isDeathChest || isDungeonChest ? 1 : 0);</b>
<b class="nc">&nbsp;					for (int idx = 0; idx &lt; endIdx; idx++) {</b>
<b class="nc">&nbsp;						String itemData = chestInfo.get(idx);</b>
<b class="nc">&nbsp;						if (worldVer.compareTo(new Version(&quot;1.9.1&quot;)) &lt; 0) // if this world is before 1.9.1</b>
<b class="nc">&nbsp;							if (itemData.equals(&quot;&quot;)) continue; // this skips any null items</b>
<b class="nc">&nbsp;						loadItemToInventory(itemData, chest.getInventory());</b>
&nbsp;					}
&nbsp;
<b class="nc">&nbsp;					if (isDeathChest) {</b>
<b class="nc">&nbsp;						((DeathChest) chest).time = Integer.parseInt(chestInfo.get(chestInfo.size() - 1).replace(&quot;tl;&quot;, &quot;&quot;)); // &quot;tl;&quot; is only for old save support</b>
<b class="nc">&nbsp;					} else if (isDungeonChest) {</b>
<b class="nc">&nbsp;						((DungeonChest) chest).setLocked(Boolean.parseBoolean(chestInfo.get(chestInfo.size() - 1)));</b>
&nbsp;					}
&nbsp;
<b class="nc">&nbsp;					currentlevel = Integer.parseInt(info.get(info.size() - 1));</b>
<b class="nc">&nbsp;					World.levels[currentlevel].add(chest instanceof DeathChest ? chest : chest instanceof DungeonChest ? (DungeonChest) chest : chest, x, y);</b>
<b class="nc">&nbsp;				} else if (newEntity instanceof Spawner) {</b>
<b class="nc">&nbsp;					MobAi mob = (MobAi) getEntity(info.get(2), player, Integer.parseInt(info.get(3)));</b>
<b class="nc">&nbsp;					currentlevel = Integer.parseInt(info.get(info.size() - 1));</b>
<b class="nc">&nbsp;					if (mob != null)</b>
<b class="nc">&nbsp;						World.levels[currentlevel].add(new Spawner(mob), x, y);</b>
<b class="nc">&nbsp;				} else {</b>
<b class="nc">&nbsp;					currentlevel = Integer.parseInt(info.get(2));</b>
<b class="nc">&nbsp;					World.levels[currentlevel].add(newEntity, x, y);</b>
&nbsp;				}
&nbsp;			} // End of entity not null conditional
&nbsp;		}
&nbsp;	}
&nbsp;
&nbsp;	public Entity getEntity(String string, Player player, int mobLevel) {
<b class="nc">&nbsp;		switch (string) {</b>
&nbsp;			case &quot;Player&quot;:
<b class="nc">&nbsp;				return player;</b>
&nbsp;			case &quot;Cow&quot;:
<b class="nc">&nbsp;				return new Cow();</b>
&nbsp;			case &quot;Sheep&quot;:
<b class="nc">&nbsp;				return new Sheep();</b>
&nbsp;			case &quot;Pig&quot;:
<b class="nc">&nbsp;				return new Pig();</b>
&nbsp;			case &quot;Zombie&quot;:
<b class="nc">&nbsp;				return new Zombie(mobLevel);</b>
&nbsp;			case &quot;Slime&quot;:
<b class="nc">&nbsp;				return new Slime(mobLevel);</b>
&nbsp;			case &quot;Creeper&quot;:
<b class="nc">&nbsp;				return new Creeper(mobLevel);</b>
&nbsp;			case &quot;Skeleton&quot;:
<b class="nc">&nbsp;				return new Skeleton(mobLevel);</b>
&nbsp;			case &quot;Knight&quot;:
<b class="nc">&nbsp;				return new Knight(mobLevel);</b>
&nbsp;			case &quot;Snake&quot;:
<b class="nc">&nbsp;				return new Snake(mobLevel);</b>
&nbsp;			case &quot;AirWizard&quot;:
<b class="nc">&nbsp;				if (mobLevel &gt; 1) return null;</b>
<b class="nc">&nbsp;				return new AirWizard();</b>
&nbsp;			case &quot;Spawner&quot;:
<b class="nc">&nbsp;				return new Spawner(new Zombie(1));</b>
&nbsp;			case &quot;Workbench&quot;:
<b class="nc">&nbsp;				return new Crafter(Crafter.Type.Workbench);</b>
&nbsp;			case &quot;Chest&quot;:
<b class="nc">&nbsp;				return new Chest();</b>
&nbsp;			case &quot;DeathChest&quot;:
<b class="nc">&nbsp;				return new DeathChest();</b>
&nbsp;			case &quot;DungeonChest&quot;:
<b class="nc">&nbsp;				return new DungeonChest(null);</b>
&nbsp;			case &quot;Anvil&quot;:
<b class="nc">&nbsp;				return new Crafter(Crafter.Type.Anvil);</b>
&nbsp;			case &quot;Enchanter&quot;:
<b class="nc">&nbsp;				return new Crafter(Crafter.Type.Enchanter);</b>
&nbsp;			case &quot;Loom&quot;:
<b class="nc">&nbsp;				return new Crafter(Crafter.Type.Loom);</b>
&nbsp;			case &quot;Furnace&quot;:
<b class="nc">&nbsp;				return new Crafter(Crafter.Type.Furnace);</b>
&nbsp;			case &quot;Oven&quot;:
<b class="nc">&nbsp;				return new Crafter(Crafter.Type.Oven);</b>
&nbsp;			case &quot;Bed&quot;:
<b class="nc">&nbsp;				return new Bed();</b>
&nbsp;			case &quot;Tnt&quot;:
<b class="nc">&nbsp;				return new Tnt();</b>
&nbsp;			case &quot;Lantern&quot;:
<b class="nc">&nbsp;				return new Lantern(Lantern.Type.NORM);</b>
&nbsp;			case &quot;IronLantern&quot;:
<b class="nc">&nbsp;				return new Lantern(Lantern.Type.IRON);</b>
&nbsp;			case &quot;GoldLantern&quot;:
<b class="nc">&nbsp;				return new Lantern(Lantern.Type.GOLD);</b>
&nbsp;			default:
<b class="nc">&nbsp;				Logger.tag(&quot;SaveLoad/LegacyLoad&quot;).warn(&quot;Unknown or outdated entity requested: &quot; + string);</b>
<b class="nc">&nbsp;				return null;</b>
&nbsp;		}
&nbsp;	}
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2024-04-19 15:54</div>
</div>
</body>
</html>
