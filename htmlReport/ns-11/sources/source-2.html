


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=windows-1252"> 
  <title>Coverage Report > AdvancementElement</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">minicraft.util</a>
</div>

<h1>Coverage Summary for Class: AdvancementElement (minicraft.util)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">AdvancementElement</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/35)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/174)
  </span>
</td>
</tr>
  <tr>
    <td class="name">AdvancementElement$1</td>
  </tr>
  <tr>
    <td class="name">AdvancementElement$AdvancementTrigger</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/9)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/22)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">AdvancementElement$AdvancementTrigger$AdvancementTriggerConditionHandler</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">AdvancementElement$AdvancementTrigger$AdvancementTriggerConditionHandler$AdvancementCriterionConditions</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">AdvancementElement$AdvancementTrigger$AdvancementTriggerConditionHandler$AdvancementCriterionConditions$ItemConditions</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/37)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">AdvancementElement$AdvancementTrigger$AdvancementTriggerConditionHandler$AdvancementCriterionConditions$LocationConditions</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/54)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">AdvancementElement$AdvancementTrigger$AdvancementTriggerConditionHandler$AdvancementCriterionConditions$Rangeable</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/14)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">AdvancementElement$AdvancementTrigger$AdvancementTriggerConditionHandler$AdvancementTriggerConditions</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">AdvancementElement$AdvancementTrigger$ImpossibleTrigger</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">AdvancementElement$AdvancementTrigger$ImpossibleTrigger$ImpossibleTriggerConditionHandler</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">AdvancementElement$AdvancementTrigger$ImpossibleTrigger$ImpossibleTriggerConditionHandler$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">AdvancementElement$AdvancementTrigger$InventoryChangedTrigger</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/12)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/83)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">AdvancementElement$AdvancementTrigger$InventoryChangedTrigger$InventoryChangedTriggerConditionHandler</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/36)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">AdvancementElement$AdvancementTrigger$InventoryChangedTrigger$InventoryChangedTriggerConditionHandler$InventoryChangedCriterionConditions</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/7)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">AdvancementElement$AdvancementTrigger$InventoryChangedTrigger$InventoryChangedTriggerConditionHandler$InventoryChangedTriggerConditions</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">AdvancementElement$AdvancementTrigger$ItemUsedOnTileTrigger</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/18)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">AdvancementElement$AdvancementTrigger$ItemUsedOnTileTrigger$ItemUsedOnTileTriggerConditionHandler</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/6)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">AdvancementElement$AdvancementTrigger$ItemUsedOnTileTrigger$ItemUsedOnTileTriggerConditionHandler$ItemUsedOnTileCriterionConditions</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">AdvancementElement$AdvancementTrigger$ItemUsedOnTileTrigger$ItemUsedOnTileTriggerConditionHandler$ItemUsedOnTileTriggerConditions</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/9)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">AdvancementElement$AdvancementTrigger$PlacedTileTrigger</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/22)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">AdvancementElement$AdvancementTrigger$PlacedTileTrigger$PlacedTileTriggerConditionHandler</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/11)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">AdvancementElement$AdvancementTrigger$PlacedTileTrigger$PlacedTileTriggerConditionHandler$PlacedTileCriterionConditions</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/6)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">AdvancementElement$AdvancementTrigger$PlacedTileTrigger$PlacedTileTriggerConditionHandler$PlacedTileTriggerConditions</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/9)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">AdvancementElement$ElementCriterion</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/6)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/15)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">AdvancementElement$ElementRewards</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/112)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/547)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package minicraft.util;
&nbsp;
&nbsp;import minicraft.core.World;
&nbsp;import minicraft.entity.furniture.Chest;
&nbsp;import minicraft.item.Inventory;
&nbsp;import minicraft.item.Item;
&nbsp;import minicraft.item.Items;
&nbsp;import minicraft.item.Recipe;
&nbsp;import minicraft.item.StackableItem;
&nbsp;import minicraft.item.ToolItem;
&nbsp;import minicraft.level.tile.Tile;
&nbsp;import minicraft.saveload.Load;
&nbsp;import minicraft.screen.CraftingDisplay;
&nbsp;import org.jetbrains.annotations.NotNull;
&nbsp;import org.jetbrains.annotations.Nullable;
&nbsp;import org.json.JSONArray;
&nbsp;import org.json.JSONException;
&nbsp;import org.json.JSONObject;
&nbsp;
&nbsp;import java.io.IOException;
&nbsp;import java.time.LocalDateTime;
&nbsp;import java.util.ArrayList;
&nbsp;import java.util.Arrays;
&nbsp;import java.util.Collection;
&nbsp;import java.util.HashMap;
&nbsp;import java.util.HashSet;
&nbsp;import java.util.Iterator;
&nbsp;import java.util.List;
&nbsp;import java.util.Map;
&nbsp;import java.util.Set;
&nbsp;import java.util.concurrent.ConcurrentHashMap;
&nbsp;import java.util.concurrent.ExecutorService;
&nbsp;import java.util.concurrent.Executors;
&nbsp;
&nbsp;/**
&nbsp; * World-wide.
&nbsp; */
&nbsp;public class AdvancementElement {
&nbsp;	private static final HashSet&lt;AdvancementElement&gt; recipeUnlockingElements;
&nbsp;
&nbsp;	static {
&nbsp;		try {
<b class="nc">&nbsp;			recipeUnlockingElements = loadAdvancementFile(&quot;/resources/recipes.json&quot;, false);</b>
<b class="nc">&nbsp;		} catch (IOException e) {</b>
<b class="nc">&nbsp;			throw new RuntimeException(e);</b>
<b class="nc">&nbsp;		}</b>
&nbsp;	}
&nbsp;
&nbsp;	public static HashSet&lt;AdvancementElement&gt; loadAdvancementFile(String filename, boolean displayable) throws IOException {
<b class="nc">&nbsp;		HashSet&lt;AdvancementElement&gt; elements = new HashSet&lt;&gt;();</b>
<b class="nc">&nbsp;		JSONObject json = new JSONObject(String.join(&quot;&quot;, Load.loadFile(filename)));</b>
<b class="nc">&nbsp;		for (String key : json.keySet()) {</b>
<b class="nc">&nbsp;			loadAdvancementElement(elements, key, json.getJSONObject(key), displayable);</b>
<b class="nc">&nbsp;		}</b>
&nbsp;
<b class="nc">&nbsp;		return elements;</b>
&nbsp;	}
&nbsp;
&nbsp;	public static void loadAdvancementElement(Collection&lt;AdvancementElement&gt; elements, String criterionName, JSONObject json, boolean displayable) {
<b class="nc">&nbsp;		HashMap&lt;String, AdvancementElement.ElementCriterion&gt; criteria = new HashMap&lt;&gt;();</b>
<b class="nc">&nbsp;		JSONObject criteriaJson = json.getJSONObject(&quot;criteria&quot;);</b>
<b class="nc">&nbsp;		if (criteriaJson.isEmpty()) throw new IndexOutOfBoundsException(&quot;criteria is empty.&quot;);</b>
<b class="nc">&nbsp;		for (String key : criteriaJson.keySet()) {</b>
<b class="nc">&nbsp;			JSONObject criterion = criteriaJson.getJSONObject(key);</b>
<b class="nc">&nbsp;			criteria.put(key, new AdvancementElement.ElementCriterion(criterion.getString(&quot;trigger&quot;), criterion.getJSONObject(&quot;conditions&quot;)));</b>
<b class="nc">&nbsp;		}</b>
&nbsp;
<b class="nc">&nbsp;		HashSet&lt;HashSet&lt;String&gt;&gt; requirements = new HashSet&lt;&gt;();</b>
<b class="nc">&nbsp;		JSONArray requirementsJson = json.optJSONArray(&quot;requirements&quot;);</b>
<b class="nc">&nbsp;		if (requirementsJson != null) {</b>
<b class="nc">&nbsp;			for (int i = 0; i &lt; requirementsJson.length(); i++) {</b>
<b class="nc">&nbsp;				HashSet&lt;String&gt; req = new HashSet&lt;&gt;();</b>
<b class="nc">&nbsp;				JSONArray reqJson = requirementsJson.getJSONArray(i);</b>
<b class="nc">&nbsp;				for (int j = 0; j &lt; reqJson.length(); j++) {</b>
<b class="nc">&nbsp;					req.add(reqJson.getString(j));</b>
&nbsp;				}
<b class="nc">&nbsp;				requirements.add(req);</b>
&nbsp;			}
&nbsp;		}
&nbsp;
<b class="nc">&nbsp;		HashMap&lt;String, AdvancementElement.ElementCriterion&gt; unlockingCriteria = new HashMap&lt;&gt;();</b>
<b class="nc">&nbsp;		JSONObject unlockingCriteriaJson = json.optJSONObject(&quot;unlocking_criteria&quot;);</b>
<b class="nc">&nbsp;		if (unlockingCriteriaJson != null) {</b>
<b class="nc">&nbsp;			for (String key : unlockingCriteriaJson.keySet()) {</b>
<b class="nc">&nbsp;				JSONObject criterion = unlockingCriteriaJson.getJSONObject(key);</b>
<b class="nc">&nbsp;				unlockingCriteria.put(key, new AdvancementElement.ElementCriterion(criterion.getString(&quot;trigger&quot;), criterion.getJSONObject(&quot;conditions&quot;)));</b>
<b class="nc">&nbsp;			}</b>
&nbsp;		}
&nbsp;
<b class="nc">&nbsp;		HashSet&lt;HashSet&lt;String&gt;&gt; unlockingRequirements = new HashSet&lt;&gt;();</b>
<b class="nc">&nbsp;		JSONArray unlockingRequirementsJson = json.optJSONArray(&quot;unlocking_requirements&quot;);</b>
<b class="nc">&nbsp;		if (unlockingRequirementsJson != null) {</b>
<b class="nc">&nbsp;			for (int i = 0; i &lt; unlockingRequirementsJson.length(); i++) {</b>
<b class="nc">&nbsp;				HashSet&lt;String&gt; req = new HashSet&lt;&gt;();</b>
<b class="nc">&nbsp;				JSONArray reqJson = unlockingRequirementsJson.getJSONArray(i);</b>
<b class="nc">&nbsp;				for (int j = 0; j &lt; reqJson.length(); j++) {</b>
<b class="nc">&nbsp;					req.add(reqJson.getString(j));</b>
&nbsp;				}
<b class="nc">&nbsp;				unlockingRequirements.add(req);</b>
&nbsp;			}
&nbsp;		}
&nbsp;
<b class="nc">&nbsp;		ElementRewards rewards = loadRewards(json.optJSONObject(&quot;rewards&quot;));</b>
<b class="nc">&nbsp;		elements.add(new AdvancementElement(criterionName,</b>
<b class="nc">&nbsp;			displayable ? json.getString(&quot;description&quot;) : null, criteria,</b>
&nbsp;			rewards, requirements, unlockingCriteria, unlockingRequirements));
&nbsp;	}
&nbsp;
&nbsp;	public static ElementRewards loadRewards(JSONObject json) {
<b class="nc">&nbsp;		ArrayList&lt;Item&gt; items = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;		ArrayList&lt;Recipe&gt; recipes = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;		if (json != null) {</b>
<b class="nc">&nbsp;			JSONArray itemsJson = json.optJSONArray(&quot;items&quot;);</b>
<b class="nc">&nbsp;			if (itemsJson != null) {</b>
<b class="nc">&nbsp;				for (int i = 0; i &lt; itemsJson.length(); i++) {</b>
<b class="nc">&nbsp;					items.add(Items.get(itemsJson.getString(i)));</b>
&nbsp;				}
&nbsp;			}
&nbsp;
<b class="nc">&nbsp;			JSONObject recipesJson = json.optJSONObject(&quot;recipes&quot;);</b>
<b class="nc">&nbsp;			if (recipesJson != null) {</b>
<b class="nc">&nbsp;				for (String product : recipesJson.keySet()) {</b>
<b class="nc">&nbsp;					JSONArray costsJson = recipesJson.getJSONArray(product);</b>
<b class="nc">&nbsp;					String[] costs = new String[costsJson.length()];</b>
<b class="nc">&nbsp;					for (int j = 0; j &lt; costsJson.length(); j++) {</b>
<b class="nc">&nbsp;						costs[j] = costsJson.getString(j);</b>
&nbsp;					}
&nbsp;
<b class="nc">&nbsp;					recipes.add(new Recipe(product, costs));</b>
<b class="nc">&nbsp;				}</b>
&nbsp;			}
&nbsp;		}
&nbsp;
<b class="nc">&nbsp;		return new ElementRewards(items, recipes);</b>
&nbsp;	}
&nbsp;
&nbsp;	public static void resetRecipeUnlockingElements() {
<b class="nc">&nbsp;		recipeUnlockingElements.forEach(AdvancementElement::reset);</b>
&nbsp;	}
&nbsp;
&nbsp;	public static void loadRecipeUnlockingElements(JSONObject json) {
<b class="nc">&nbsp;		resetRecipeUnlockingElements();</b>
<b class="nc">&nbsp;		for (String k : json.keySet()) {</b>
<b class="nc">&nbsp;			recipeUnlockingElements.stream().filter(e -&gt; e.key.equals(k))</b>
<b class="nc">&nbsp;				.findFirst().ifPresent(element -&gt; element.load(json.getJSONObject(k)));</b>
<b class="nc">&nbsp;		}</b>
&nbsp;	}
&nbsp;
&nbsp;	/**
&nbsp;	 * Saving and writing all data into the given JSONObject.
&nbsp;	 */
&nbsp;	public static void saveRecipeUnlockingElements(JSONObject json) {
<b class="nc">&nbsp;		recipeUnlockingElements.forEach(element -&gt; element.save(json));</b>
&nbsp;	}
&nbsp;
&nbsp;
&nbsp;	public final String key;
&nbsp;	public final String description;
&nbsp;
<b class="nc">&nbsp;	protected final HashMap&lt;String, ElementCriterion&gt; criteria = new HashMap&lt;&gt;();</b>
&nbsp;	protected final @Nullable ElementRewards rewards;
<b class="nc">&nbsp;	protected final HashSet&lt;HashSet&lt;String&gt;&gt; requirements = new HashSet&lt;&gt;();</b>
<b class="nc">&nbsp;	protected final HashMap&lt;String, ElementCriterion&gt; unlockingCriteria = new HashMap&lt;&gt;();</b>
<b class="nc">&nbsp;	protected final HashSet&lt;HashSet&lt;String&gt;&gt; unlockingRequirements = new HashSet&lt;&gt;();</b>
<b class="nc">&nbsp;	protected boolean completed = false;</b>
<b class="nc">&nbsp;	protected boolean unlocked = false;</b>
&nbsp;
&nbsp;	public AdvancementElement(String key, String description, Map&lt;String, ElementCriterion&gt; criteria,
&nbsp;	                          @Nullable ElementRewards rewards, @NotNull Set&lt;HashSet&lt;String&gt;&gt; requirements,
&nbsp;	                          @NotNull Map&lt;String, ElementCriterion&gt; unlockingCriteria,
<b class="nc">&nbsp;	                          @NotNull Set&lt;HashSet&lt;String&gt;&gt; unlockingRequirements) {</b>
<b class="nc">&nbsp;		this.key = key;</b>
<b class="nc">&nbsp;		this.description = description;</b>
<b class="nc">&nbsp;		this.criteria.putAll(criteria);</b>
<b class="nc">&nbsp;		this.criteria.forEach((k, criterion) -&gt; criterion.element = this);</b>
<b class="nc">&nbsp;		this.rewards = rewards;</b>
<b class="nc">&nbsp;		this.requirements.addAll(requirements);</b>
<b class="nc">&nbsp;		this.unlockingCriteria.putAll(unlockingCriteria);</b>
<b class="nc">&nbsp;		this.unlockingCriteria.forEach((k, criterion) -&gt; criterion.element = this);</b>
<b class="nc">&nbsp;		this.unlockingRequirements.addAll(unlockingRequirements);</b>
&nbsp;	}
&nbsp;
&nbsp;	public static class ElementCriterion {
&nbsp;		protected final AdvancementTrigger trigger;
&nbsp;		protected final AdvancementTrigger.AdvancementTriggerConditionHandler.AdvancementCriterionConditions conditions;
<b class="nc">&nbsp;		protected AdvancementElement element = null;</b>
&nbsp;		// #completionTime field here is used for statistics and debugging.
<b class="nc">&nbsp;		protected @Nullable LocalDateTime completionTime = null; // null if not completed.</b>
&nbsp;
<b class="nc">&nbsp;		public ElementCriterion(String trigger, JSONObject conditions) {</b>
<b class="nc">&nbsp;			this.trigger = AdvancementTrigger.getTrigger(trigger);</b>
<b class="nc">&nbsp;			this.conditions = this.trigger.conditions.createCriterionConditions(conditions);</b>
&nbsp;		}
&nbsp;
&nbsp;		protected void registerCriterion() {
<b class="nc">&nbsp;			if (completionTime == null)</b>
<b class="nc">&nbsp;				this.trigger.register(this);</b>
&nbsp;		}
&nbsp;
&nbsp;		public boolean isCompleted() {
<b class="nc">&nbsp;			return completionTime != null;</b>
&nbsp;		}
&nbsp;
&nbsp;		@SuppressWarnings(&quot;unused&quot;)
&nbsp;		public @Nullable LocalDateTime getCompletionTime() {
<b class="nc">&nbsp;			return completionTime;</b>
&nbsp;		}
&nbsp;
&nbsp;		/**
&nbsp;		 * Marking the criterion as completed if it has not already been completed.
&nbsp;		 * @param inLoad If this is {@code false}, triggers the status updater.
&nbsp;		 * @param completionTime The completion time. Using the current datetime if this is {@code null}.
&nbsp;		 */
&nbsp;		public void markAsCompleted(boolean inLoad, @Nullable LocalDateTime completionTime) {
<b class="nc">&nbsp;			if (this.completionTime == null) {</b>
<b class="nc">&nbsp;				trigger.registeredCriteria.remove(this);</b>
<b class="nc">&nbsp;				this.completionTime = completionTime == null ? LocalDateTime.now() : completionTime;</b>
<b class="nc">&nbsp;				if (!inLoad &amp;&amp; element != null)</b>
<b class="nc">&nbsp;					element.update();</b>
&nbsp;			}
&nbsp;		}
&nbsp;
&nbsp;		public void reset() {
<b class="nc">&nbsp;			completionTime = null;</b>
&nbsp;		}
&nbsp;	}
&nbsp;
&nbsp;	public static class ElementRewards {
&nbsp;		private final ArrayList&lt;Item&gt; items;
&nbsp;		private final ArrayList&lt;Recipe&gt; recipes;
&nbsp;
<b class="nc">&nbsp;		public ElementRewards(ArrayList&lt;Item&gt; items, ArrayList&lt;Recipe&gt; recipes) {</b>
<b class="nc">&nbsp;			this.items = items;</b>
<b class="nc">&nbsp;			this.recipes = recipes;</b>
&nbsp;		}
&nbsp;
&nbsp;		public ArrayList&lt;Item&gt; getItems() {
<b class="nc">&nbsp;			return new ArrayList&lt;&gt;(items);</b>
&nbsp;		}
&nbsp;
&nbsp;		public ArrayList&lt;Recipe&gt; getRecipe() {
<b class="nc">&nbsp;			return new ArrayList&lt;&gt;(recipes);</b>
&nbsp;		}
&nbsp;	}
&nbsp;
&nbsp;	@SuppressWarnings(&quot;unused&quot;)
&nbsp;	public @Nullable ElementRewards getRewards() {
<b class="nc">&nbsp;		return rewards;</b>
&nbsp;	}
&nbsp;
&nbsp;	public void markAsCompleted(boolean inLoad) {
<b class="nc">&nbsp;		if (!completed) {</b>
<b class="nc">&nbsp;			completed = true;</b>
<b class="nc">&nbsp;			if (!inLoad)</b>
<b class="nc">&nbsp;				update();</b>
&nbsp;		}
&nbsp;	}
&nbsp;
&nbsp;	protected boolean checkIsUnlocked() {
<b class="nc">&nbsp;		if (unlocked) return true;</b>
<b class="nc">&nbsp;		return isUnlockable();</b>
&nbsp;	}
&nbsp;
&nbsp;	protected void registerUnlockingCriteria() {
<b class="nc">&nbsp;		unlockingCriteria.values().forEach(criterion -&gt; {</b>
<b class="nc">&nbsp;			if (criterion.completionTime == null)</b>
<b class="nc">&nbsp;				criterion.registerCriterion();</b>
&nbsp;		});
&nbsp;	}
&nbsp;
&nbsp;	protected void registerCriteria() {
<b class="nc">&nbsp;		criteria.values().forEach(criterion -&gt; {</b>
<b class="nc">&nbsp;			if (criterion.completionTime == null)</b>
<b class="nc">&nbsp;				criterion.registerCriterion();</b>
&nbsp;		});
&nbsp;	}
&nbsp;
&nbsp;	/**
&nbsp;	 * Warning: This method should be used carefully as this could impact
&nbsp;	 * the gaming experience deeply on the progress.
&nbsp;	 */
&nbsp;	public void deregisterCriteria() {
<b class="nc">&nbsp;		criteria.values().forEach(criterion -&gt; {</b>
<b class="nc">&nbsp;			criterion.trigger.registeredCriteria.remove(criterion);</b>
&nbsp;		});
&nbsp;	}
&nbsp;
&nbsp;	public boolean isCompleted() {
<b class="nc">&nbsp;		return completed;</b>
&nbsp;	}
&nbsp;
&nbsp;	public boolean isUnlocked() {
<b class="nc">&nbsp;		return unlocked;</b>
&nbsp;	}
&nbsp;
&nbsp;	/**
&nbsp;	 * Is unlocked but not completed.
&nbsp;	 */
&nbsp;	public boolean isDisplayableAtStatus() {
<b class="nc">&nbsp;		return unlocked &amp;&amp; !completed;</b>
&nbsp;	}
&nbsp;
&nbsp;	public int getNumCriteriaCompleted() {
<b class="nc">&nbsp;		return (int) criteria.values().stream().filter(ElementCriterion::isCompleted).count();</b>
&nbsp;	}
&nbsp;
&nbsp;	public int getTotalNumCriteria() {
<b class="nc">&nbsp;		return criteria.size();</b>
&nbsp;	}
&nbsp;
&nbsp;	public boolean shouldAllCriteriaBeCompleted() {
<b class="nc">&nbsp;		return requirements.isEmpty();</b>
&nbsp;	}
&nbsp;
&nbsp;	protected boolean isUnlockable() {
<b class="nc">&nbsp;		if (unlocked) return true;</b>
<b class="nc">&nbsp;		return unlockingRequirements.isEmpty() &amp;&amp; unlockingCriteria.values().stream().allMatch(criterion -&gt; criterion.completionTime != null) ||</b>
<b class="nc">&nbsp;			!unlockingRequirements.isEmpty() &amp;&amp; unlockingRequirements.stream().allMatch(sublist -&gt; sublist.stream().anyMatch(k -&gt; {</b>
<b class="nc">&nbsp;				ElementCriterion criterion = criteria.get(k);</b>
<b class="nc">&nbsp;				return criterion != null &amp;&amp; criterion.completionTime != null;</b>
&nbsp;			}));
&nbsp;	}
&nbsp;
&nbsp;	protected boolean checkIsCompleted() {
<b class="nc">&nbsp;		return requirements.isEmpty() &amp;&amp; criteria.values().stream().allMatch(criterion -&gt; criterion.completionTime != null) ||</b>
<b class="nc">&nbsp;			!requirements.isEmpty() &amp;&amp; requirements.stream().allMatch(sublist -&gt; sublist.stream().anyMatch(k -&gt; {</b>
<b class="nc">&nbsp;				ElementCriterion criterion = criteria.get(k);</b>
<b class="nc">&nbsp;				return criterion != null &amp;&amp; criterion.completionTime != null;</b>
&nbsp;			}));
&nbsp;	}
&nbsp;
&nbsp;	/**
&nbsp;	 * Updating and refreshing by the data in this element.
&nbsp;	 */
&nbsp;	public void update() {
<b class="nc">&nbsp;		registerUnlockingCriteria();</b>
&nbsp;
<b class="nc">&nbsp;		if (!unlocked) {</b>
<b class="nc">&nbsp;			unlocked = checkIsUnlocked();</b>
&nbsp;		}
&nbsp;
<b class="nc">&nbsp;		if (unlocked) registerCriteria();</b>
<b class="nc">&nbsp;		if (!completed &amp;&amp; unlocked) {</b>
<b class="nc">&nbsp;			if (checkIsCompleted()) {</b>
<b class="nc">&nbsp;				markAsCompleted(true); // To not call #update() again.</b>
<b class="nc">&nbsp;				sendRewards();</b>
&nbsp;			}
&nbsp;		}
&nbsp;	}
&nbsp;
&nbsp;	protected void sendRewards() {
<b class="nc">&nbsp;		if (rewards != null) {</b>
<b class="nc">&nbsp;			ArrayList&lt;Item&gt; items = rewards.getItems();</b>
<b class="nc">&nbsp;			if (items.size() &gt; 0) {</b>
<b class="nc">&nbsp;				Chest chest = new Chest(&quot;Rewards&quot;);</b>
<b class="nc">&nbsp;				chest.x = World.player.x;</b>
<b class="nc">&nbsp;				chest.y = World.player.y;</b>
<b class="nc">&nbsp;				for (Item item : items) chest.getInventory().add(item);</b>
<b class="nc">&nbsp;				World.levels[World.currentLevel].add(chest);</b>
&nbsp;			}
&nbsp;
<b class="nc">&nbsp;			ArrayList&lt;Recipe&gt; recipes = rewards.getRecipe();</b>
<b class="nc">&nbsp;			if (recipes.size() &gt; 0) {</b>
<b class="nc">&nbsp;				recipes.forEach(CraftingDisplay::unlockRecipe);</b>
&nbsp;			}
&nbsp;		}
&nbsp;	}
&nbsp;
&nbsp;	public void reset() {
<b class="nc">&nbsp;		reset(true);</b>
&nbsp;	}
&nbsp;
&nbsp;	protected void reset(boolean update) {
<b class="nc">&nbsp;		completed = false;</b>
<b class="nc">&nbsp;		unlocked = false;</b>
<b class="nc">&nbsp;		criteria.values().forEach(ElementCriterion::reset);</b>
<b class="nc">&nbsp;		if (update) update();</b>
&nbsp;	}
&nbsp;
&nbsp;	/**
&nbsp;	 * Loading from a JSONObject of an element.
&nbsp;	 */
&nbsp;	public void load(JSONObject json) {
<b class="nc">&nbsp;		reset(false);</b>
<b class="nc">&nbsp;		completed = json.optBoolean(&quot;done&quot;);</b>
<b class="nc">&nbsp;		unlocked = json.optBoolean(&quot;unlocked&quot;);</b>
<b class="nc">&nbsp;		JSONObject criteriaJson = json.optJSONObject(&quot;criteria&quot;);</b>
<b class="nc">&nbsp;		if (criteriaJson != null) {</b>
<b class="nc">&nbsp;			for (String k : criteriaJson.keySet()) {</b>
<b class="nc">&nbsp;				ElementCriterion criterion = criteria.get(k);</b>
<b class="nc">&nbsp;				if (criterion != null) {</b>
<b class="nc">&nbsp;					criterion.markAsCompleted(true, LocalDateTime.parse(criteriaJson.getString(k)));</b>
&nbsp;				}
<b class="nc">&nbsp;			}</b>
&nbsp;		}
&nbsp;
<b class="nc">&nbsp;		JSONObject unlockingCriteriaJson = json.optJSONObject(&quot;unlockingCriteria&quot;);</b>
<b class="nc">&nbsp;		if (unlockingCriteriaJson != null) {</b>
<b class="nc">&nbsp;			for (String k : unlockingCriteriaJson.keySet()) {</b>
<b class="nc">&nbsp;				ElementCriterion criterion = unlockingCriteria.get(k);</b>
<b class="nc">&nbsp;				if (criterion != null) {</b>
<b class="nc">&nbsp;					criterion.markAsCompleted(true, LocalDateTime.parse(unlockingCriteriaJson.getString(k)));</b>
&nbsp;				}
<b class="nc">&nbsp;			}</b>
&nbsp;		}
&nbsp;
<b class="nc">&nbsp;		update();</b>
&nbsp;	}
&nbsp;
&nbsp;	/**
&nbsp;	 * Saving and writing data to the root JSONObject
&nbsp;	 */
&nbsp;	public void save(JSONObject json) {
<b class="nc">&nbsp;		JSONObject elementJson = new JSONObject();</b>
<b class="nc">&nbsp;		JSONObject criteriaJson = new JSONObject();</b>
<b class="nc">&nbsp;		criteria.forEach((k, criterion) -&gt; {</b>
<b class="nc">&nbsp;			if (criterion.completionTime != null)</b>
<b class="nc">&nbsp;				criteriaJson.put(k, criterion.completionTime.toString());</b>
&nbsp;		});
<b class="nc">&nbsp;		if (!criteriaJson.isEmpty()) {</b>
<b class="nc">&nbsp;			elementJson.put(&quot;criteria&quot;, criteriaJson);</b>
<b class="nc">&nbsp;			elementJson.put(&quot;done&quot;, completed);</b>
&nbsp;		}
&nbsp;
<b class="nc">&nbsp;		JSONObject unlockingCriteriaJson = new JSONObject();</b>
<b class="nc">&nbsp;		unlockingCriteria.forEach((k, criterion) -&gt; {</b>
<b class="nc">&nbsp;			if (criterion.completionTime != null)</b>
<b class="nc">&nbsp;				unlockingCriteriaJson.put(k, criterion.completionTime.toString());</b>
&nbsp;		});
<b class="nc">&nbsp;		if (!unlockingCriteriaJson.isEmpty()) {</b>
<b class="nc">&nbsp;			elementJson.put(&quot;unlockingCriteria&quot;, unlockingCriteriaJson);</b>
<b class="nc">&nbsp;			elementJson.put(&quot;unlocked&quot;, unlocked);</b>
&nbsp;		}
&nbsp;
<b class="nc">&nbsp;		if (!elementJson.isEmpty())</b>
<b class="nc">&nbsp;			json.put(key, elementJson);</b>
&nbsp;	}
&nbsp;
<b class="nc">&nbsp;	public static abstract class AdvancementTrigger {</b>
&nbsp;		// Used for threaded trigger handling.
<b class="nc">&nbsp;		private static final Set&lt;ElementCriterion&gt; pendingCompletedCriteria = ConcurrentHashMap.newKeySet();</b>
&nbsp;
&nbsp;		public static void tick() {
<b class="nc">&nbsp;			for (Iterator&lt;ElementCriterion&gt; it = pendingCompletedCriteria.iterator(); it.hasNext(); ) {</b>
<b class="nc">&nbsp;				ElementCriterion criterion = it.next();</b>
<b class="nc">&nbsp;				criterion.markAsCompleted(false, null);</b>
<b class="nc">&nbsp;				it.remove(); // Action done.</b>
<b class="nc">&nbsp;			}</b>
&nbsp;		}
&nbsp;
<b class="nc">&nbsp;		private static final ExecutorService executorService = Executors.newCachedThreadPool();</b>
&nbsp;
&nbsp;		protected final AdvancementTriggerConditionHandler conditions;
&nbsp;
<b class="nc">&nbsp;		protected AdvancementTrigger(AdvancementTriggerConditionHandler conditions) {</b>
<b class="nc">&nbsp;			this.conditions = conditions;</b>
&nbsp;		}
&nbsp;
<b class="nc">&nbsp;		private static final HashMap&lt;String, AdvancementTrigger&gt; triggers = new HashMap&lt;&gt;();</b>
&nbsp;
&nbsp;		static {
<b class="nc">&nbsp;			triggers.put(&quot;impossible&quot;, ImpossibleTrigger.INSTANCE);</b>
<b class="nc">&nbsp;			triggers.put(&quot;inventory_changed&quot;, InventoryChangedTrigger.INSTANCE);</b>
<b class="nc">&nbsp;			triggers.put(&quot;placed_tile&quot;, PlacedTileTrigger.INSTANCE);</b>
&nbsp;			//noinspection StaticInitializerReferencesSubClass
<b class="nc">&nbsp;			triggers.put(&quot;item_used_on_tile&quot;, ItemUsedOnTileTrigger.INSTANCE);</b>
&nbsp;		}
&nbsp;
&nbsp;		@NotNull
&nbsp;		public static AdvancementElement.AdvancementTrigger getTrigger(String key) {
<b class="nc">&nbsp;			return triggers.getOrDefault(key, ImpossibleTrigger.INSTANCE);</b>
&nbsp;		}
&nbsp;
<b class="nc">&nbsp;		protected final HashSet&lt;ElementCriterion&gt; registeredCriteria = new HashSet&lt;&gt;();</b>
&nbsp;
&nbsp;		public void register(ElementCriterion criterion) {
<b class="nc">&nbsp;			registeredCriteria.add(criterion);</b>
&nbsp;		}
&nbsp;
&nbsp;		/**
&nbsp;		 * This should be called by another thread if method {@link #singleThreadNeeded()} is not
&nbsp;		 * implemented to return true. If false, this should use {@link #pendingCompletedCriteria}
&nbsp;		 * to mark completed criteria instead of calling it directly as this method should be called
&nbsp;		 * by the global game tick updater to ensure the synchronization.
&nbsp;		 */
&nbsp;		protected abstract void trigger0(AdvancementTriggerConditionHandler.AdvancementTriggerConditions conditions);
&nbsp;
&nbsp;		/**
&nbsp;		 * @return {@code true} if this trigger implementation requires single thread as the global game tick updater.
&nbsp;		 */
&nbsp;		protected boolean singleThreadNeeded() {
<b class="nc">&nbsp;			return true;</b>
&nbsp;		}
&nbsp;
&nbsp;		/**
&nbsp;		 * Triggering and checking passes by another thread.
&nbsp;		 */
&nbsp;		public void trigger(AdvancementTriggerConditionHandler.AdvancementTriggerConditions conditions) {
<b class="nc">&nbsp;			if (!singleThreadNeeded()) executorService.submit(() -&gt; trigger0(conditions));</b>
<b class="nc">&nbsp;			else trigger0(conditions);</b>
&nbsp;		}
&nbsp;
&nbsp;		@SuppressWarnings(&quot;unused&quot;)
&nbsp;		@NotNull
&nbsp;		public AdvancementElement.AdvancementTrigger.AdvancementTriggerConditionHandler getConditions() {
<b class="nc">&nbsp;			return conditions;</b>
&nbsp;		}
&nbsp;
&nbsp;		public abstract static class AdvancementTriggerConditionHandler {
<b class="nc">&nbsp;			protected AdvancementTriggerConditionHandler() {</b>
&nbsp;			}
&nbsp;
&nbsp;			@NotNull
&nbsp;			public abstract AdvancementCriterionConditions createCriterionConditions(JSONObject json) throws JSONException;
&nbsp;
&nbsp;			/**
&nbsp;			 * A condition carrier for the corresponding trigger.
&nbsp;			 */
<b class="nc">&nbsp;			public abstract static class AdvancementTriggerConditions {</b>
&nbsp;			}
&nbsp;
&nbsp;			public abstract static class AdvancementCriterionConditions {
<b class="nc">&nbsp;				protected AdvancementCriterionConditions() {</b>
&nbsp;				}
&nbsp;
<b class="nc">&nbsp;				public static class Rangeable&lt;T extends Number &amp; Comparable&lt;T&gt;&gt; {</b>
&nbsp;					public final @Nullable T min;
&nbsp;					public final @Nullable T max;
&nbsp;
<b class="nc">&nbsp;					public Rangeable(@Nullable T min, @Nullable T max) {</b>
<b class="nc">&nbsp;						this.min = min;</b>
<b class="nc">&nbsp;						this.max = max;</b>
&nbsp;					}
&nbsp;
&nbsp;					@SuppressWarnings(&quot;BooleanMethodIsAlwaysInverted&quot;)
&nbsp;					public static boolean isAbsent(@Nullable Rangeable&lt;?&gt; rangeable) {
<b class="nc">&nbsp;						if (rangeable == null) return true;</b>
<b class="nc">&nbsp;						return rangeable.min == null &amp;&amp; rangeable.max == null;</b>
&nbsp;					}
&nbsp;
&nbsp;					@SuppressWarnings(&quot;BooleanMethodIsAlwaysInverted&quot;)
&nbsp;					private boolean inRange(T value) {
<b class="nc">&nbsp;						if (min == null &amp;&amp; max == null) return true; // The range is not ranged.</b>
<b class="nc">&nbsp;						if (min == null) return max.compareTo(value) &gt;= 0;</b>
<b class="nc">&nbsp;						if (max == null) return min.compareTo(value) &lt;= 0;</b>
<b class="nc">&nbsp;						return max.compareTo(value) &gt;= 0 &amp;&amp; min.compareTo(value) &lt;= 0;</b>
&nbsp;					}
&nbsp;
&nbsp;					@Override
&nbsp;					public String toString() {
<b class="nc">&nbsp;						return isAbsent(this) ? &quot;&lt;unspecified range&gt;&quot; :</b>
<b class="nc">&nbsp;							min == null ? &quot;max: &quot; + max :</b>
<b class="nc">&nbsp;								max == null ? &quot;min: &quot; + min :</b>
<b class="nc">&nbsp;									String.format(&quot;min: %s;max: %s&quot;, min, max);</b>
&nbsp;					}
&nbsp;				}
&nbsp;
<b class="nc">&nbsp;				public static class ItemConditions {</b>
<b class="nc">&nbsp;					private final HashSet&lt;String&gt; items = new HashSet&lt;&gt;();</b>
&nbsp;					private final @Nullable Rangeable&lt;Integer&gt; count;
&nbsp;					private final @Nullable Rangeable&lt;Integer&gt; durability;
&nbsp;
<b class="nc">&nbsp;					private ItemConditions(Set&lt;String&gt; items, @Nullable Rangeable&lt;Integer&gt; count, @Nullable Rangeable&lt;Integer&gt; durability) {</b>
<b class="nc">&nbsp;						this.items.addAll(items);</b>
<b class="nc">&nbsp;						this.count = count;</b>
<b class="nc">&nbsp;						this.durability = durability;</b>
&nbsp;					}
&nbsp;
&nbsp;					/**
&nbsp;					 * @param json The JSON object by the {@code item} key.
&nbsp;					 * @return {@code null} if the object is {@code null}.
&nbsp;					 */
&nbsp;					private static ItemConditions getFromJson(JSONObject json) {
<b class="nc">&nbsp;						if (json == null) return null;</b>
<b class="nc">&nbsp;						HashSet&lt;String&gt; items = new HashSet&lt;&gt;();</b>
<b class="nc">&nbsp;						Rangeable&lt;Integer&gt; count = null;</b>
<b class="nc">&nbsp;						Rangeable&lt;Integer&gt; durability = null;</b>
<b class="nc">&nbsp;						JSONArray itemItemsJson = json.optJSONArray(&quot;items&quot;);</b>
<b class="nc">&nbsp;						if (itemItemsJson != null) for (int j = 0; j &lt; itemItemsJson.length(); j++) {</b>
<b class="nc">&nbsp;							items.add(itemItemsJson.getString(j));</b>
&nbsp;						}
&nbsp;
<b class="nc">&nbsp;						if (json.has(&quot;count&quot;)) try {</b>
<b class="nc">&nbsp;							int val = json.getInt(&quot;count&quot;);</b>
<b class="nc">&nbsp;							count = new Rangeable&lt;&gt;(val, val);</b>
<b class="nc">&nbsp;						} catch (JSONException e) { // Not an integer.</b>
<b class="nc">&nbsp;							JSONObject val = json.getJSONObject(&quot;count&quot;);</b>
<b class="nc">&nbsp;							count = new Rangeable&lt;&gt;(val.has(&quot;min&quot;) ? val.getInt(&quot;min&quot;) : null,</b>
<b class="nc">&nbsp;								val.has(&quot;max&quot;) ? val.getInt(&quot;max&quot;) : null);</b>
<b class="nc">&nbsp;						}</b>
&nbsp;
<b class="nc">&nbsp;						if (json.has(&quot;durability&quot;)) try {</b>
<b class="nc">&nbsp;							int val = json.getInt(&quot;durability&quot;);</b>
<b class="nc">&nbsp;							durability = new Rangeable&lt;&gt;(val, val);</b>
<b class="nc">&nbsp;						} catch (JSONException e) { // Not an integer.</b>
<b class="nc">&nbsp;							JSONObject val = json.getJSONObject(&quot;durability&quot;);</b>
<b class="nc">&nbsp;							durability = new Rangeable&lt;&gt;(val.has(&quot;min&quot;) ? val.getInt(&quot;min&quot;) : null,</b>
<b class="nc">&nbsp;								val.has(&quot;max&quot;) ? val.getInt(&quot;max&quot;) : null);</b>
<b class="nc">&nbsp;						}</b>
&nbsp;
<b class="nc">&nbsp;						return new ItemConditions(items, count, durability);</b>
&nbsp;					}
&nbsp;
&nbsp;					@SuppressWarnings(&quot;BooleanMethodIsAlwaysInverted&quot;)
&nbsp;					private boolean matches(Item item) {
<b class="nc">&nbsp;						if (!Rangeable.isAbsent(count))</b>
<b class="nc">&nbsp;							if (!count.inRange(item instanceof StackableItem ? ((StackableItem) item).count : 1))</b>
<b class="nc">&nbsp;								return false;</b>
<b class="nc">&nbsp;						if (!Rangeable.isAbsent(durability) &amp;&amp; item instanceof ToolItem)</b>
<b class="nc">&nbsp;							if (!durability.inRange(((ToolItem) item).dur))</b>
<b class="nc">&nbsp;								return false;</b>
<b class="nc">&nbsp;						return items.isEmpty() || items.stream().anyMatch(s -&gt; s.equalsIgnoreCase(item.getName()));</b>
&nbsp;					}
&nbsp;				}
&nbsp;
&nbsp;				/**
&nbsp;				 * Tile location.
&nbsp;				 */
<b class="nc">&nbsp;				public static class LocationConditions {</b>
<b class="nc">&nbsp;					private final HashSet&lt;String&gt; tiles = new HashSet&lt;&gt;();</b>
&nbsp;					private final @Nullable Integer level;
&nbsp;					private final @Nullable Integer data;
&nbsp;					private final @Nullable Rangeable&lt;Double&gt; x;
&nbsp;					private final @Nullable Rangeable&lt;Double&gt; y;
&nbsp;
&nbsp;					private LocationConditions(Set&lt;String&gt; tiles, @Nullable Integer level, @Nullable Integer data,
<b class="nc">&nbsp;					                           @Nullable Rangeable&lt;Double&gt; x, @Nullable Rangeable&lt;Double&gt; y) {</b>
<b class="nc">&nbsp;						this.tiles.addAll(tiles);</b>
<b class="nc">&nbsp;						this.level = level;</b>
<b class="nc">&nbsp;						this.data = data;</b>
<b class="nc">&nbsp;						this.x = x;</b>
<b class="nc">&nbsp;						this.y = y;</b>
&nbsp;					}
&nbsp;
&nbsp;					private static LocationConditions getFromJson(JSONObject json) {
<b class="nc">&nbsp;						if (json == null) return null;</b>
<b class="nc">&nbsp;						HashSet&lt;String&gt; tiles = new HashSet&lt;&gt;();</b>
<b class="nc">&nbsp;						Integer level = null;</b>
<b class="nc">&nbsp;						Integer data = null;</b>
<b class="nc">&nbsp;						Rangeable&lt;Double&gt; x = null;</b>
<b class="nc">&nbsp;						Rangeable&lt;Double&gt; y = null;</b>
<b class="nc">&nbsp;						JSONObject tileJson = json.optJSONObject(&quot;tile&quot;);</b>
<b class="nc">&nbsp;						if (tileJson != null) {</b>
<b class="nc">&nbsp;							JSONArray tilesJson = tileJson.optJSONArray(&quot;tiles&quot;);</b>
<b class="nc">&nbsp;							if (tilesJson != null) for (int j = 0; j &lt; tilesJson.length(); j++) {</b>
<b class="nc">&nbsp;								tiles.add(tilesJson.getString(j));</b>
&nbsp;							}
&nbsp;
&nbsp;							try {
<b class="nc">&nbsp;								data = tileJson.getInt(&quot;data&quot;);</b>
<b class="nc">&nbsp;							} catch (JSONException ignored) {</b>
<b class="nc">&nbsp;							}</b>
&nbsp;						}
&nbsp;
&nbsp;						try {
<b class="nc">&nbsp;							level = json.getInt(&quot;level&quot;);</b>
<b class="nc">&nbsp;						} catch (JSONException ignored) {</b>
<b class="nc">&nbsp;						}</b>
&nbsp;
<b class="nc">&nbsp;						JSONObject positionJson = json.optJSONObject(&quot;position&quot;);</b>
<b class="nc">&nbsp;						if (json.has(&quot;x&quot;)) try {</b>
<b class="nc">&nbsp;							double val = positionJson.getDouble(&quot;x&quot;);</b>
<b class="nc">&nbsp;							x = new Rangeable&lt;&gt;(val, val);</b>
<b class="nc">&nbsp;						} catch (JSONException e) { // Not an integer.</b>
<b class="nc">&nbsp;							JSONObject val = positionJson.getJSONObject(&quot;x&quot;);</b>
<b class="nc">&nbsp;							x = new Rangeable&lt;&gt;(val.has(&quot;min&quot;) ? val.getDouble(&quot;min&quot;) : null,</b>
<b class="nc">&nbsp;								val.has(&quot;max&quot;) ? val.getDouble(&quot;max&quot;) : null);</b>
<b class="nc">&nbsp;						}</b>
&nbsp;
<b class="nc">&nbsp;						if (json.has(&quot;y&quot;)) try {</b>
<b class="nc">&nbsp;							double val = positionJson.getDouble(&quot;y&quot;);</b>
<b class="nc">&nbsp;							y = new Rangeable&lt;&gt;(val, val);</b>
<b class="nc">&nbsp;						} catch (JSONException e) { // Not an integer.</b>
<b class="nc">&nbsp;							JSONObject val = positionJson.getJSONObject(&quot;y&quot;);</b>
<b class="nc">&nbsp;							y = new Rangeable&lt;&gt;(val.has(&quot;min&quot;) ? val.getDouble(&quot;min&quot;) : null,</b>
<b class="nc">&nbsp;								val.has(&quot;max&quot;) ? val.getDouble(&quot;max&quot;) : null);</b>
<b class="nc">&nbsp;						}</b>
&nbsp;
<b class="nc">&nbsp;						return new LocationConditions(tiles, level, data, x, y);</b>
&nbsp;					}
&nbsp;
&nbsp;					@SuppressWarnings(&quot;BooleanMethodIsAlwaysInverted&quot;)
&nbsp;					private boolean matches(Tile tile, int data, int x, int y, int level) {
<b class="nc">&nbsp;						if (this.level != null &amp;&amp; !this.level.equals(level))</b>
<b class="nc">&nbsp;							return false;</b>
<b class="nc">&nbsp;						if (this.data != null &amp;&amp; !this.data.equals(data))</b>
<b class="nc">&nbsp;							return false;</b>
<b class="nc">&nbsp;						if (!Rangeable.isAbsent(this.x))</b>
<b class="nc">&nbsp;							if (!this.x.inRange((double) x))</b>
<b class="nc">&nbsp;								return false;</b>
<b class="nc">&nbsp;						if (!Rangeable.isAbsent(this.y))</b>
<b class="nc">&nbsp;							if (!this.y.inRange((double) y))</b>
<b class="nc">&nbsp;								return false;</b>
<b class="nc">&nbsp;						return tiles.isEmpty() || tiles.stream().anyMatch(s -&gt; s.equalsIgnoreCase(tile.name));</b>
&nbsp;					}
&nbsp;				}
&nbsp;			}
&nbsp;		}
&nbsp;
&nbsp;		public static class ImpossibleTrigger extends AdvancementTrigger {
<b class="nc">&nbsp;			public static final ImpossibleTrigger INSTANCE = new ImpossibleTrigger();</b>
&nbsp;
&nbsp;			protected ImpossibleTrigger() {
<b class="nc">&nbsp;				super(new ImpossibleTriggerConditionHandler());</b>
&nbsp;			}
&nbsp;
&nbsp;			@Override
&nbsp;			public void register(ElementCriterion criterion) {
<b class="nc">&nbsp;			} // No action.</b>
&nbsp;
&nbsp;			@Override
&nbsp;			protected void trigger0(AdvancementTriggerConditionHandler.AdvancementTriggerConditions conditions) {
<b class="nc">&nbsp;			} // No action.</b>
&nbsp;
<b class="nc">&nbsp;			public static class ImpossibleTriggerConditionHandler extends AdvancementTriggerConditionHandler {</b>
&nbsp;
&nbsp;				@Override
&nbsp;				public @NotNull AdvancementElement.AdvancementTrigger.AdvancementTriggerConditionHandler.AdvancementCriterionConditions createCriterionConditions(JSONObject json) {
<b class="nc">&nbsp;					return new AdvancementCriterionConditions() {</b>
&nbsp;					}; // Empty.
&nbsp;				}
&nbsp;			}
&nbsp;		}
&nbsp;
&nbsp;		public static class InventoryChangedTrigger extends AdvancementTrigger {
<b class="nc">&nbsp;			public static final InventoryChangedTrigger INSTANCE = new InventoryChangedTrigger();</b>
&nbsp;
&nbsp;			protected InventoryChangedTrigger() {
<b class="nc">&nbsp;				super(new InventoryChangedTriggerConditionHandler());</b>
&nbsp;			}
&nbsp;
&nbsp;			@Override
&nbsp;			protected boolean singleThreadNeeded() {
<b class="nc">&nbsp;				return false;</b>
&nbsp;			}
&nbsp;
&nbsp;			@Override
&nbsp;			protected void trigger0(AdvancementTriggerConditionHandler.AdvancementTriggerConditions conditions) {
<b class="nc">&nbsp;				if (conditions instanceof InventoryChangedTriggerConditionHandler.InventoryChangedTriggerConditions) {</b>
<b class="nc">&nbsp;					ArrayList&lt;Item&gt; items = ((InventoryChangedTriggerConditionHandler.InventoryChangedTriggerConditions) conditions).items;</b>
<b class="nc">&nbsp;					int maxSlots = ((InventoryChangedTriggerConditionHandler.InventoryChangedTriggerConditions) conditions).maxSlots;</b>
<b class="nc">&nbsp;					for (ElementCriterion criterion : new HashSet&lt;&gt;(registeredCriteria)) {</b>
<b class="nc">&nbsp;						if (criterion.conditions instanceof InventoryChangedTriggerConditionHandler.InventoryChangedCriterionConditions) {</b>
<b class="nc">&nbsp;							InventoryChangedTriggerConditionHandler.InventoryChangedCriterionConditions criterionConditions =</b>
&nbsp;								(InventoryChangedTriggerConditionHandler.InventoryChangedCriterionConditions) criterion.conditions;
<b class="nc">&nbsp;							if (!AdvancementTriggerConditionHandler.AdvancementCriterionConditions.Rangeable.isAbsent(criterionConditions.slotsEmpty))</b>
<b class="nc">&nbsp;								if (!criterionConditions.slotsEmpty.inRange(maxSlots - items.size()))</b>
<b class="nc">&nbsp;									continue;</b>
<b class="nc">&nbsp;							if (!AdvancementTriggerConditionHandler.AdvancementCriterionConditions.Rangeable.isAbsent(criterionConditions.slotsFull))</b>
<b class="nc">&nbsp;								if (!criterionConditions.slotsFull.inRange((int) items.stream().filter(i -&gt;</b>
<b class="nc">&nbsp;									!(i instanceof StackableItem) || ((StackableItem) i).count &gt;= ((StackableItem) i).maxCount).count()))</b>
<b class="nc">&nbsp;									continue;</b>
<b class="nc">&nbsp;							if (!AdvancementTriggerConditionHandler.AdvancementCriterionConditions.Rangeable.isAbsent(criterionConditions.slotsOccupied))</b>
<b class="nc">&nbsp;								if (!criterionConditions.slotsOccupied.inRange(items.size()))</b>
<b class="nc">&nbsp;									continue;</b>
<b class="nc">&nbsp;							if (!criterionConditions.items.isEmpty() &amp;&amp; !isConditionalMatched(items, criterionConditions.items)) {</b>
<b class="nc">&nbsp;								continue;</b>
&nbsp;							}
<b class="nc">&nbsp;							pendingCompletedCriteria.add(criterion); // All conditions passed.</b>
&nbsp;						}
<b class="nc">&nbsp;					}</b>
&nbsp;				}
&nbsp;			}
&nbsp;
&nbsp;			/**
&nbsp;			 * Modified from {@link #test(List, List)}.
&nbsp;			 */
&nbsp;			private static boolean isConditionalMatched(ArrayList&lt;Item&gt; items,
&nbsp;			                                            HashSet&lt;InventoryChangedTriggerConditionHandler.InventoryChangedCriterionConditions.ItemConditions&gt; itemConditions) {
<b class="nc">&nbsp;				Set&lt;HashMap&lt;InventoryChangedTriggerConditionHandler.InventoryChangedCriterionConditions.ItemConditions, String&gt;&gt; combinations = new HashSet&lt;&gt;();</b>
<b class="nc">&nbsp;				List&lt;List&lt;String&gt;&gt; combinationsOutput = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;				List&lt;InventoryChangedTriggerConditionHandler.InventoryChangedCriterionConditions.ItemConditions&gt; conditionsList = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;				List&lt;List&lt;String&gt;&gt; itemStringCombinations = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;				itemConditions.forEach(c -&gt; {</b>
<b class="nc">&nbsp;					if (!c.items.isEmpty()) {</b>
<b class="nc">&nbsp;						conditionsList.add(c);</b>
<b class="nc">&nbsp;						itemStringCombinations.add(new ArrayList&lt;&gt;(c.items));</b>
&nbsp;					}
&nbsp;				});
<b class="nc">&nbsp;				if (!conditionsList.isEmpty()) getCombinations(combinationsOutput, itemStringCombinations);</b>
<b class="nc">&nbsp;				for (List&lt;String&gt; c : combinationsOutput) {</b>
<b class="nc">&nbsp;					HashMap&lt;InventoryChangedTriggerConditionHandler.InventoryChangedCriterionConditions.ItemConditions, String&gt; cOut = new HashMap&lt;&gt;();</b>
<b class="nc">&nbsp;					for (int i = 0; i &lt; conditionsList.size(); i++) {</b>
<b class="nc">&nbsp;						cOut.put(conditionsList.get(i), c.get(i));</b>
&nbsp;					}
<b class="nc">&nbsp;					combinations.add(cOut);</b>
<b class="nc">&nbsp;				}</b>
&nbsp;
<b class="nc">&nbsp;				if (combinations.isEmpty()) {</b>
<b class="nc">&nbsp;					return allMatch(items, new HashSet&lt;&gt;(itemConditions), new HashMap&lt;&gt;());</b>
&nbsp;				} else {
<b class="nc">&nbsp;					for (HashMap&lt;InventoryChangedTriggerConditionHandler.InventoryChangedCriterionConditions.ItemConditions, String&gt; c : combinations) {</b>
<b class="nc">&nbsp;						if (allMatch(items, new HashSet&lt;&gt;(itemConditions), c))</b>
<b class="nc">&nbsp;							return true;</b>
<b class="nc">&nbsp;					}</b>
<b class="nc">&nbsp;					return false;</b>
&nbsp;				}
&nbsp;			}
&nbsp;
&nbsp;			/**
&nbsp;			 * Used by {@link #allMatch(Collection, Collection, HashMap)} for conditional check for each element.
&nbsp;			 */
&nbsp;			private static boolean isMatched(Item item, InventoryChangedTriggerConditionHandler.InventoryChangedCriterionConditions.ItemConditions itemConditions,
&nbsp;			                                 @Nullable String selectedItem) {
<b class="nc">&nbsp;				if (!itemConditions.matches(item))</b>
<b class="nc">&nbsp;					return false;</b>
<b class="nc">&nbsp;				return selectedItem == null || item.getName().equalsIgnoreCase(selectedItem);</b>
&nbsp;			}
&nbsp;
&nbsp;			/**
&nbsp;			 * Modified from {@link #containsAll(List, List)}.
&nbsp;			 */
&nbsp;			private static boolean allMatch(Collection&lt;Item&gt; source, Collection&lt;InventoryChangedTriggerConditionHandler.InventoryChangedCriterionConditions.ItemConditions&gt; target,
&nbsp;			                                HashMap&lt;InventoryChangedTriggerConditionHandler.InventoryChangedCriterionConditions.ItemConditions, String&gt; selectedItems) {
<b class="nc">&nbsp;				for (Item e : source) {</b>
<b class="nc">&nbsp;					target.removeIf(conditions1 -&gt; isMatched(e, conditions1, selectedItems.get(conditions1)));</b>
<b class="nc">&nbsp;					if (target.isEmpty()) {</b>
<b class="nc">&nbsp;						return true;</b>
&nbsp;					}
<b class="nc">&nbsp;				}</b>
&nbsp;
<b class="nc">&nbsp;				return target.size() == 0;</b>
&nbsp;			}
&nbsp;
&nbsp;			/**
&nbsp;			 * Original archive of array elements matching.
&nbsp;			 */
&nbsp;			@SuppressWarnings(&quot;unused&quot;) // Keeping for future reference.
&nbsp;			private static &lt;T&gt; boolean test(List&lt;T&gt; list, List&lt;List&lt;T&gt;&gt; matcher) {
<b class="nc">&nbsp;				List&lt;List&lt;T&gt;&gt; combinations = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;				getCombinations(combinations, matcher);</b>
<b class="nc">&nbsp;				for (List&lt;T&gt; matcher1 : combinations) {</b>
<b class="nc">&nbsp;					if (containsAll(list, matcher1))</b>
<b class="nc">&nbsp;						return true;</b>
<b class="nc">&nbsp;				}</b>
<b class="nc">&nbsp;				return false;</b>
&nbsp;			}
&nbsp;
&nbsp;			/**
&nbsp;			 * Original archive of array elements matching.
&nbsp;			 */
&nbsp;			private static &lt;T&gt; boolean containsAll(List&lt;T&gt; source, List&lt;T&gt; target) {
<b class="nc">&nbsp;				for (T e : source) {</b>
<b class="nc">&nbsp;					target.remove(e);</b>
<b class="nc">&nbsp;					if (target.isEmpty()) {</b>
<b class="nc">&nbsp;						return true;</b>
&nbsp;					}
<b class="nc">&nbsp;				}</b>
&nbsp;
<b class="nc">&nbsp;				return target.size() == 0;</b>
&nbsp;			}
&nbsp;
&nbsp;			private static &lt;T&gt; void getCombinations(List&lt;List&lt;T&gt;&gt; output, List&lt;List&lt;T&gt;&gt; matcher) {
<b class="nc">&nbsp;				List&lt;List&lt;Integer&gt;&gt; indices = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;				List&lt;Integer&gt; elementSizes = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;				matcher.forEach(m -&gt; elementSizes.add(m.size()));</b>
<b class="nc">&nbsp;				helper(indices, elementSizes, null, 0);</b>
<b class="nc">&nbsp;				for (List&lt;Integer&gt; ints : indices) {</b>
<b class="nc">&nbsp;					List&lt;T&gt; matcher1 = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;					for (int i = 0; i &lt; ints.size(); i++) {</b>
<b class="nc">&nbsp;						matcher1.add(matcher.get(i).get(ints.get(i)));</b>
&nbsp;					}
<b class="nc">&nbsp;					output.add(matcher1);</b>
<b class="nc">&nbsp;				}</b>
&nbsp;			}
&nbsp;
&nbsp;			private static void helper(List&lt;List&lt;Integer&gt;&gt; output, List&lt;Integer&gt; elementSizes, @Nullable ArrayList&lt;Integer&gt; buffer, int index) {
<b class="nc">&nbsp;				for (int i = 0; i &lt; elementSizes.get(index); i++) {</b>
<b class="nc">&nbsp;					if (buffer == null) buffer = new ArrayList&lt;&gt;(Arrays.asList(new Integer[elementSizes.size()]));</b>
<b class="nc">&nbsp;					buffer.set(index, i);</b>
<b class="nc">&nbsp;					if (index &lt; elementSizes.size() - 1) {</b>
<b class="nc">&nbsp;						helper(output, elementSizes, buffer, index + 1);</b>
&nbsp;					} else {
<b class="nc">&nbsp;						output.add(new ArrayList&lt;&gt;(buffer));</b>
&nbsp;					}
&nbsp;				}
&nbsp;			}
&nbsp;
<b class="nc">&nbsp;			public static class InventoryChangedTriggerConditionHandler extends AdvancementTriggerConditionHandler {</b>
&nbsp;				@Override
&nbsp;				public @NotNull AdvancementCriterionConditions createCriterionConditions(JSONObject json) throws JSONException {
<b class="nc">&nbsp;					HashSet&lt;InventoryChangedCriterionConditions.ItemConditions&gt; items = new HashSet&lt;&gt;();</b>
<b class="nc">&nbsp;					InventoryChangedCriterionConditions.Rangeable&lt;Integer&gt; slotsEmpty = null;</b>
<b class="nc">&nbsp;					InventoryChangedCriterionConditions.Rangeable&lt;Integer&gt; slotsFull = null;</b>
<b class="nc">&nbsp;					InventoryChangedCriterionConditions.Rangeable&lt;Integer&gt; slotsOccupied = null;</b>
<b class="nc">&nbsp;					JSONArray itemsJson = json.optJSONArray(&quot;items&quot;);</b>
<b class="nc">&nbsp;					if (itemsJson != null) {</b>
<b class="nc">&nbsp;						for (int i = 0; i &lt; itemsJson.length(); i++) {</b>
<b class="nc">&nbsp;							items.add(InventoryChangedCriterionConditions.ItemConditions.getFromJson(itemsJson.getJSONObject(i)));</b>
&nbsp;						}
&nbsp;					}
&nbsp;
<b class="nc">&nbsp;					JSONObject slotsJson = json.optJSONObject(&quot;slots&quot;);</b>
<b class="nc">&nbsp;					if (slotsJson != null) {</b>
<b class="nc">&nbsp;						if (slotsJson.has(&quot;empty&quot;)) try {</b>
<b class="nc">&nbsp;							int val = slotsJson.getInt(&quot;empty&quot;);</b>
<b class="nc">&nbsp;							slotsEmpty = new InventoryChangedCriterionConditions.Rangeable&lt;&gt;(val, val);</b>
<b class="nc">&nbsp;						} catch (JSONException e) { // Not an integer.</b>
<b class="nc">&nbsp;							JSONObject val = slotsJson.getJSONObject(&quot;empty&quot;);</b>
<b class="nc">&nbsp;							slotsEmpty = new InventoryChangedCriterionConditions.Rangeable&lt;&gt;(val.has(&quot;min&quot;) ? val.getInt(&quot;min&quot;) : null,</b>
<b class="nc">&nbsp;								val.has(&quot;max&quot;) ? val.getInt(&quot;max&quot;) : null);</b>
<b class="nc">&nbsp;						}</b>
&nbsp;
<b class="nc">&nbsp;						if (slotsJson.has(&quot;full&quot;)) try {</b>
<b class="nc">&nbsp;							int val = slotsJson.getInt(&quot;full&quot;);</b>
<b class="nc">&nbsp;							slotsFull = new InventoryChangedCriterionConditions.Rangeable&lt;&gt;(val, val);</b>
<b class="nc">&nbsp;						} catch (JSONException e) { // Not an integer.</b>
<b class="nc">&nbsp;							JSONObject val = slotsJson.getJSONObject(&quot;full&quot;);</b>
<b class="nc">&nbsp;							slotsFull = new InventoryChangedCriterionConditions.Rangeable&lt;&gt;(val.has(&quot;min&quot;) ? val.getInt(&quot;min&quot;) : null,</b>
<b class="nc">&nbsp;								val.has(&quot;max&quot;) ? val.getInt(&quot;max&quot;) : null);</b>
<b class="nc">&nbsp;						}</b>
&nbsp;
<b class="nc">&nbsp;						if (slotsJson.has(&quot;occupied&quot;)) try {</b>
<b class="nc">&nbsp;							int val = slotsJson.getInt(&quot;occupied&quot;);</b>
<b class="nc">&nbsp;							slotsOccupied = new InventoryChangedCriterionConditions.Rangeable&lt;&gt;(val, val);</b>
<b class="nc">&nbsp;						} catch (JSONException e) { // Not an integer.</b>
<b class="nc">&nbsp;							JSONObject val = slotsJson.getJSONObject(&quot;occupied&quot;);</b>
<b class="nc">&nbsp;							slotsOccupied = new InventoryChangedCriterionConditions.Rangeable&lt;&gt;(val.has(&quot;min&quot;) ? val.getInt(&quot;min&quot;) : null,</b>
<b class="nc">&nbsp;								val.has(&quot;max&quot;) ? val.getInt(&quot;max&quot;) : null);</b>
<b class="nc">&nbsp;						}</b>
&nbsp;					}
&nbsp;
<b class="nc">&nbsp;					return new InventoryChangedCriterionConditions(items, slotsEmpty, slotsFull, slotsOccupied);</b>
&nbsp;				}
&nbsp;
<b class="nc">&nbsp;				public static class InventoryChangedTriggerConditions extends AdvancementTriggerConditions {</b>
<b class="nc">&nbsp;					private final ArrayList&lt;Item&gt; items = new ArrayList&lt;&gt;();</b>
&nbsp;					private final int maxSlots;
&nbsp;
<b class="nc">&nbsp;					public InventoryChangedTriggerConditions(Inventory inventory) {</b>
<b class="nc">&nbsp;						items.addAll(inventory.getItems());</b>
<b class="nc">&nbsp;						maxSlots = inventory.getMaxSlots();</b>
&nbsp;					}
&nbsp;				}
&nbsp;
<b class="nc">&nbsp;				public static class InventoryChangedCriterionConditions extends AdvancementCriterionConditions {</b>
<b class="nc">&nbsp;					private final HashSet&lt;ItemConditions&gt; items = new HashSet&lt;&gt;();</b>
&nbsp;					private final @Nullable Rangeable&lt;Integer&gt; slotsEmpty;
&nbsp;					private final @Nullable Rangeable&lt;Integer&gt; slotsFull;
&nbsp;					private final @Nullable Rangeable&lt;Integer&gt; slotsOccupied;
&nbsp;
&nbsp;					private InventoryChangedCriterionConditions(Set&lt;ItemConditions&gt; items, @Nullable Rangeable&lt;Integer&gt; slotsEmpty,
<b class="nc">&nbsp;					                                            @Nullable Rangeable&lt;Integer&gt; slotsFull, @Nullable Rangeable&lt;Integer&gt; slotsOccupied) {</b>
<b class="nc">&nbsp;						this.items.addAll(items);</b>
<b class="nc">&nbsp;						this.slotsEmpty = slotsEmpty;</b>
<b class="nc">&nbsp;						this.slotsFull = slotsFull;</b>
<b class="nc">&nbsp;						this.slotsOccupied = slotsOccupied;</b>
&nbsp;					}
&nbsp;				}
&nbsp;			}
&nbsp;		}
&nbsp;
&nbsp;		public static class PlacedTileTrigger extends AdvancementTrigger {
<b class="nc">&nbsp;			public static final PlacedTileTrigger INSTANCE = new PlacedTileTrigger();</b>
&nbsp;
&nbsp;			protected PlacedTileTrigger() {
<b class="nc">&nbsp;				super(new PlacedTileTriggerConditionHandler());</b>
&nbsp;			}
&nbsp;
&nbsp;			@Override
&nbsp;			protected void trigger0(AdvancementTriggerConditionHandler.AdvancementTriggerConditions conditions) {
<b class="nc">&nbsp;				if (conditions instanceof PlacedTileTriggerConditionHandler.PlacedTileTriggerConditions) {</b>
<b class="nc">&nbsp;					Item item = ((PlacedTileTriggerConditionHandler.PlacedTileTriggerConditions) conditions).item;</b>
<b class="nc">&nbsp;					Tile tile = ((PlacedTileTriggerConditionHandler.PlacedTileTriggerConditions) conditions).tile;</b>
<b class="nc">&nbsp;					int data = ((PlacedTileTriggerConditionHandler.PlacedTileTriggerConditions) conditions).data;</b>
<b class="nc">&nbsp;					int x = ((PlacedTileTriggerConditionHandler.PlacedTileTriggerConditions) conditions).x;</b>
<b class="nc">&nbsp;					int y = ((PlacedTileTriggerConditionHandler.PlacedTileTriggerConditions) conditions).y;</b>
<b class="nc">&nbsp;					int level = ((PlacedTileTriggerConditionHandler.PlacedTileTriggerConditions) conditions).level;</b>
<b class="nc">&nbsp;					for (ElementCriterion criterion : new HashSet&lt;&gt;(registeredCriteria)) {</b>
<b class="nc">&nbsp;						if (criterion.conditions instanceof PlacedTileTriggerConditionHandler.PlacedTileCriterionConditions) {</b>
<b class="nc">&nbsp;							PlacedTileTriggerConditionHandler.PlacedTileCriterionConditions criterionConditions =</b>
&nbsp;								(PlacedTileTriggerConditionHandler.PlacedTileCriterionConditions) criterion.conditions;
<b class="nc">&nbsp;							if (criterionConditions.tile != null &amp;&amp; !criterionConditions.tile.equalsIgnoreCase(tile.name))</b>
<b class="nc">&nbsp;								continue;</b>
<b class="nc">&nbsp;							if (criterionConditions.item != null &amp;&amp; !criterionConditions.item.matches(item))</b>
<b class="nc">&nbsp;								continue;</b>
<b class="nc">&nbsp;							if (criterionConditions.location != null &amp;&amp; !criterionConditions.location.matches(tile, data, x, y, level))</b>
<b class="nc">&nbsp;								continue;</b>
<b class="nc">&nbsp;							if (criterionConditions.data != null &amp;&amp; !criterionConditions.data.equals(data))</b>
<b class="nc">&nbsp;								continue;</b>
<b class="nc">&nbsp;							criterion.markAsCompleted(false, null); // All conditions passed.</b>
&nbsp;						}
<b class="nc">&nbsp;					}</b>
&nbsp;				}
&nbsp;			}
&nbsp;
<b class="nc">&nbsp;			public static class PlacedTileTriggerConditionHandler extends AdvancementTriggerConditionHandler {</b>
&nbsp;				@Override
&nbsp;				public @NotNull AdvancementCriterionConditions createCriterionConditions(JSONObject json) throws JSONException {
<b class="nc">&nbsp;					String tile = json.optString(&quot;tile&quot;, null);</b>
<b class="nc">&nbsp;					AdvancementCriterionConditions.ItemConditions item =</b>
<b class="nc">&nbsp;						AdvancementCriterionConditions.ItemConditions.getFromJson(json.optJSONObject(&quot;item&quot;));</b>
<b class="nc">&nbsp;					AdvancementCriterionConditions.LocationConditions location =</b>
<b class="nc">&nbsp;						AdvancementCriterionConditions.LocationConditions.getFromJson(json.optJSONObject(&quot;location&quot;));</b>
<b class="nc">&nbsp;					Integer data = null;</b>
&nbsp;					try {
<b class="nc">&nbsp;						data = json.getInt(&quot;data&quot;);</b>
<b class="nc">&nbsp;					} catch (JSONException ignored) {</b>
<b class="nc">&nbsp;					}</b>
<b class="nc">&nbsp;					return new PlacedTileCriterionConditions(tile, item, location, data);</b>
&nbsp;				}
&nbsp;
<b class="nc">&nbsp;				public static class PlacedTileTriggerConditions extends AdvancementTriggerConditions {</b>
&nbsp;					private final Item item;
&nbsp;					private final Tile tile;
&nbsp;					private final int data;
&nbsp;					private final int x;
&nbsp;					private final int y;
&nbsp;					private final int level;
&nbsp;
<b class="nc">&nbsp;					public PlacedTileTriggerConditions(Item item, Tile tile, int data, int x, int y, int level) {</b>
<b class="nc">&nbsp;						this.item = item;</b>
<b class="nc">&nbsp;						this.tile = tile;</b>
<b class="nc">&nbsp;						this.data = data;</b>
<b class="nc">&nbsp;						this.x = x;</b>
<b class="nc">&nbsp;						this.y = y;</b>
<b class="nc">&nbsp;						this.level = level;</b>
<b class="nc">&nbsp;					}</b>
&nbsp;				}
&nbsp;
<b class="nc">&nbsp;				public static class PlacedTileCriterionConditions extends AdvancementCriterionConditions {</b>
&nbsp;					private final @Nullable String tile;
&nbsp;					private final @Nullable ItemConditions item;
&nbsp;					private final @Nullable LocationConditions location;
&nbsp;					private final @Nullable Integer data;
&nbsp;
&nbsp;					private PlacedTileCriterionConditions(@Nullable String tile, @Nullable ItemConditions item,
<b class="nc">&nbsp;					                                      @Nullable LocationConditions location, @Nullable Integer data) {</b>
<b class="nc">&nbsp;						this.tile = tile;</b>
<b class="nc">&nbsp;						this.item = item;</b>
<b class="nc">&nbsp;						this.location = location;</b>
<b class="nc">&nbsp;						this.data = data;</b>
&nbsp;					}
&nbsp;				}
&nbsp;			}
&nbsp;		}
&nbsp;
&nbsp;		public static class ItemUsedOnTileTrigger extends AdvancementTrigger {
<b class="nc">&nbsp;			public static final ItemUsedOnTileTrigger INSTANCE = new ItemUsedOnTileTrigger();</b>
&nbsp;
&nbsp;			protected ItemUsedOnTileTrigger() {
<b class="nc">&nbsp;				super(new ItemUsedOnTileTriggerConditionHandler());</b>
&nbsp;			}
&nbsp;
&nbsp;			@Override
&nbsp;			protected void trigger0(AdvancementTriggerConditionHandler.AdvancementTriggerConditions conditions) {
<b class="nc">&nbsp;				if (conditions instanceof ItemUsedOnTileTriggerConditionHandler.ItemUsedOnTileTriggerConditions) {</b>
<b class="nc">&nbsp;					Item item = ((ItemUsedOnTileTriggerConditionHandler.ItemUsedOnTileTriggerConditions) conditions).item;</b>
<b class="nc">&nbsp;					Tile tile = ((ItemUsedOnTileTriggerConditionHandler.ItemUsedOnTileTriggerConditions) conditions).tile;</b>
<b class="nc">&nbsp;					int data = ((ItemUsedOnTileTriggerConditionHandler.ItemUsedOnTileTriggerConditions) conditions).data;</b>
<b class="nc">&nbsp;					int x = ((ItemUsedOnTileTriggerConditionHandler.ItemUsedOnTileTriggerConditions) conditions).x;</b>
<b class="nc">&nbsp;					int y = ((ItemUsedOnTileTriggerConditionHandler.ItemUsedOnTileTriggerConditions) conditions).y;</b>
<b class="nc">&nbsp;					int level = ((ItemUsedOnTileTriggerConditionHandler.ItemUsedOnTileTriggerConditions) conditions).level;</b>
<b class="nc">&nbsp;					for (ElementCriterion criterion : new HashSet&lt;&gt;(registeredCriteria)) {</b>
<b class="nc">&nbsp;						if (criterion.conditions instanceof ItemUsedOnTileTriggerConditionHandler.ItemUsedOnTileCriterionConditions) {</b>
<b class="nc">&nbsp;							ItemUsedOnTileTriggerConditionHandler.ItemUsedOnTileCriterionConditions criterionConditions =</b>
&nbsp;								(ItemUsedOnTileTriggerConditionHandler.ItemUsedOnTileCriterionConditions) criterion.conditions;
<b class="nc">&nbsp;							if (criterionConditions.location != null &amp;&amp; !criterionConditions.location.matches(tile, data, x, y, level))</b>
<b class="nc">&nbsp;								continue;</b>
<b class="nc">&nbsp;							if (criterionConditions.item != null &amp;&amp; !criterionConditions.item.matches(item))</b>
<b class="nc">&nbsp;								continue;</b>
<b class="nc">&nbsp;							criterion.markAsCompleted(false, null); // All conditions passed.</b>
&nbsp;						}
<b class="nc">&nbsp;					}</b>
&nbsp;				}
&nbsp;			}
&nbsp;
<b class="nc">&nbsp;			public static class ItemUsedOnTileTriggerConditionHandler extends AdvancementTriggerConditionHandler {</b>
&nbsp;				@Override
&nbsp;				public @NotNull AdvancementCriterionConditions createCriterionConditions(JSONObject json) throws JSONException {
<b class="nc">&nbsp;					AdvancementTriggerConditionHandler.AdvancementCriterionConditions.LocationConditions location =</b>
<b class="nc">&nbsp;						AdvancementTriggerConditionHandler.AdvancementCriterionConditions.LocationConditions.getFromJson(json.optJSONObject(&quot;location&quot;));</b>
<b class="nc">&nbsp;					AdvancementTriggerConditionHandler.AdvancementCriterionConditions.ItemConditions item =</b>
<b class="nc">&nbsp;						AdvancementTriggerConditionHandler.AdvancementCriterionConditions.ItemConditions.getFromJson(json.optJSONObject(&quot;item&quot;));</b>
<b class="nc">&nbsp;					return new ItemUsedOnTileTriggerConditionHandler.ItemUsedOnTileCriterionConditions(location, item);</b>
&nbsp;				}
&nbsp;
<b class="nc">&nbsp;				public static class ItemUsedOnTileTriggerConditions extends AdvancementTriggerConditions {</b>
&nbsp;					private final Item item;
&nbsp;					private final Tile tile;
&nbsp;					private final int data;
&nbsp;					private final int x;
&nbsp;					private final int y;
&nbsp;					private final int level;
&nbsp;
<b class="nc">&nbsp;					public ItemUsedOnTileTriggerConditions(Item item, Tile tile, int data, int x, int y, int level) {</b>
<b class="nc">&nbsp;						this.item = item;</b>
<b class="nc">&nbsp;						this.tile = tile;</b>
<b class="nc">&nbsp;						this.data = data;</b>
<b class="nc">&nbsp;						this.x = x;</b>
<b class="nc">&nbsp;						this.y = y;</b>
<b class="nc">&nbsp;						this.level = level;</b>
<b class="nc">&nbsp;					}</b>
&nbsp;				}
&nbsp;
<b class="nc">&nbsp;				public static class ItemUsedOnTileCriterionConditions extends AdvancementCriterionConditions {</b>
&nbsp;					private final @Nullable LocationConditions location;
&nbsp;					private final @Nullable ItemConditions item;
&nbsp;
<b class="nc">&nbsp;					private ItemUsedOnTileCriterionConditions(@Nullable LocationConditions location, @Nullable ItemConditions item) {</b>
<b class="nc">&nbsp;						this.location = location;</b>
<b class="nc">&nbsp;						this.item = item;</b>
&nbsp;					}
&nbsp;				}
&nbsp;			}
&nbsp;		}
&nbsp;	}
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2024-04-18 20:02</div>
</div>
</body>
</html>
