


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=windows-1252"> 
  <title>Coverage Report > FileHandler</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">minicraft.core.io</a>
</div>

<h1>Coverage Summary for Class: FileHandler (minicraft.core.io)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">FileHandler</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/11)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/81)
  </span>
</td>
</tr>
  <tr>
    <td class="name">FileHandler$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/20)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/16)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/101)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package minicraft.core.io;
&nbsp;
&nbsp;import minicraft.core.CrashHandler;
&nbsp;import minicraft.core.Game;
&nbsp;import minicraft.saveload.Save;
&nbsp;import minicraft.util.Logging;
&nbsp;import org.jetbrains.annotations.Nullable;
&nbsp;
&nbsp;import java.io.File;
&nbsp;import java.io.IOException;
&nbsp;import java.net.URISyntaxException;
&nbsp;import java.net.URL;
&nbsp;import java.nio.file.FileSystem;
&nbsp;import java.nio.file.FileSystemNotFoundException;
&nbsp;import java.nio.file.FileSystems;
&nbsp;import java.nio.file.FileVisitResult;
&nbsp;import java.nio.file.FileVisitor;
&nbsp;import java.nio.file.Files;
&nbsp;import java.nio.file.Path;
&nbsp;import java.nio.file.Paths;
&nbsp;import java.nio.file.StandardCopyOption;
&nbsp;import java.nio.file.attribute.BasicFileAttributes;
&nbsp;import java.util.ArrayList;
&nbsp;import java.util.Collections;
&nbsp;import java.util.Objects;
&nbsp;import java.util.stream.Stream;
&nbsp;
&nbsp;public class FileHandler extends Game {
&nbsp;	private FileHandler() {
&nbsp;	}
&nbsp;
&nbsp;	public static final int REPLACE_EXISTING = 0;
&nbsp;	public static final int RENAME_COPY = 1;
&nbsp;	public static final int SKIP = 2;
&nbsp;
&nbsp;	public static final String OS;
&nbsp;	private static final String localGameDir;
&nbsp;	static final String systemGameDir;
&nbsp;
&nbsp;	static {
<b class="nc">&nbsp;		OS = System.getProperty(&quot;os.name&quot;).toLowerCase();</b>
<b class="nc">&nbsp;		String local = &quot;playminicraft/mods/Minicraft_Plus&quot;;</b>
&nbsp;
<b class="nc">&nbsp;		if (OS.contains(&quot;windows&quot;)) // windows</b>
<b class="nc">&nbsp;			systemGameDir = System.getenv(&quot;APPDATA&quot;);</b>
&nbsp;		else {
<b class="nc">&nbsp;			systemGameDir = System.getProperty(&quot;user.home&quot;);</b>
<b class="nc">&nbsp;			if (!OS.contains(&quot;mac&quot;))</b>
<b class="nc">&nbsp;				local = &quot;.&quot; + local; // linux</b>
&nbsp;		}
&nbsp;
<b class="nc">&nbsp;		localGameDir = &quot;/&quot; + local;</b>
&nbsp;	}
&nbsp;
&nbsp;
&nbsp;	/**
&nbsp;	 * Determines the path the game will use to store worlds, settings, resource packs, etc.
&nbsp;	 * If saveDir is not null, use it as the game directory. Otherwise use the default path.
&nbsp;	 * &lt;p&gt;
&nbsp;	 * If the default path is used, check if old default path exists and if so move it to the new path.
&nbsp;	 * @param saveDir Value from --savedir argument. Null if it was not set.
&nbsp;	 */
&nbsp;	public static void determineGameDir(@Nullable String saveDir) {
<b class="nc">&nbsp;		if (saveDir != null) {</b>
<b class="nc">&nbsp;			gameDir = saveDir;</b>
<b class="nc">&nbsp;			Logging.GAMEHANDLER.debug(&quot;Determined gameDir: &quot; + gameDir);</b>
&nbsp;
<b class="nc">&nbsp;			File gameDirFile = new File(gameDir);</b>
<b class="nc">&nbsp;			gameDirFile.mkdirs();</b>
<b class="nc">&nbsp;		} else {</b>
<b class="nc">&nbsp;			saveDir = FileHandler.getSystemGameDir();</b>
&nbsp;
<b class="nc">&nbsp;			gameDir = saveDir + localGameDir;</b>
<b class="nc">&nbsp;			Logging.GAMEHANDLER.debug(&quot;Determined gameDir: &quot; + gameDir);</b>
&nbsp;
<b class="nc">&nbsp;			File testFile = new File(gameDir);</b>
<b class="nc">&nbsp;			testFile.mkdirs();</b>
&nbsp;
<b class="nc">&nbsp;			File oldFolder = new File(saveDir + &quot;/.playminicraft/mods/Minicraft Plus&quot;);</b>
<b class="nc">&nbsp;			if (oldFolder.exists()) {</b>
&nbsp;				try {
<b class="nc">&nbsp;					copyFolderContents(oldFolder.toPath(), testFile.toPath(), RENAME_COPY, true);</b>
<b class="nc">&nbsp;				} catch (IOException e) {</b>
<b class="nc">&nbsp;					CrashHandler.errorHandle(e);</b>
<b class="nc">&nbsp;				}</b>
&nbsp;			}
&nbsp;
<b class="nc">&nbsp;			if (OS.contains(&quot;mac&quot;)) {</b>
<b class="nc">&nbsp;				oldFolder = new File(saveDir + &quot;/.playminicraft&quot;);</b>
<b class="nc">&nbsp;				if (oldFolder.exists()) {</b>
&nbsp;					try {
<b class="nc">&nbsp;						copyFolderContents(oldFolder.toPath(), testFile.toPath(), RENAME_COPY, true);</b>
<b class="nc">&nbsp;					} catch (IOException e) {</b>
<b class="nc">&nbsp;						CrashHandler.errorHandle(e);</b>
<b class="nc">&nbsp;					}</b>
&nbsp;				}
&nbsp;			}
&nbsp;		}
&nbsp;	}
&nbsp;
&nbsp;	public static String getSystemGameDir() {
<b class="nc">&nbsp;		return systemGameDir;</b>
&nbsp;	}
&nbsp;
&nbsp;	public static String getLocalGameDir() {
<b class="nc">&nbsp;		return localGameDir;</b>
&nbsp;	}
&nbsp;
&nbsp;	private static void deleteFolder(File top) {
<b class="nc">&nbsp;		if (top == null) return;</b>
<b class="nc">&nbsp;		if (top.isDirectory()) {</b>
<b class="nc">&nbsp;			File[] subfiles = top.listFiles();</b>
<b class="nc">&nbsp;			if (subfiles != null)</b>
<b class="nc">&nbsp;				for (File subfile : subfiles)</b>
<b class="nc">&nbsp;					deleteFolder(subfile);</b>
&nbsp;		}
&nbsp;
&nbsp;		//noinspection ResultOfMethodCallIgnored
<b class="nc">&nbsp;		top.delete();</b>
&nbsp;	}
&nbsp;
&nbsp;	public static void copyFolderContents(Path origFolder, Path newFolder, int ifExisting, boolean deleteOriginal) throws IOException {
&nbsp;		// I can determine the local folder structure with origFolder.relativize(file), then use newFolder.resolve(relative).
<b class="nc">&nbsp;		Logging.RESOURCEHANDLER.info(&quot;Copying contents of folder &quot; + origFolder + &quot; to new folder &quot; + newFolder);</b>
&nbsp;
<b class="nc">&nbsp;		Files.walkFileTree(origFolder, new FileVisitor&lt;Path&gt;() {</b>
&nbsp;			public FileVisitResult visitFile(Path file, BasicFileAttributes attr) {
<b class="nc">&nbsp;				String newFilename = newFolder.resolve(origFolder.relativize(file)).toString();</b>
<b class="nc">&nbsp;				if (new File(newFilename).exists()) {</b>
<b class="nc">&nbsp;					if (ifExisting == SKIP)</b>
<b class="nc">&nbsp;						return FileVisitResult.CONTINUE;</b>
<b class="nc">&nbsp;					else if (ifExisting == RENAME_COPY) {</b>
<b class="nc">&nbsp;						newFilename = newFilename.substring(0, newFilename.lastIndexOf(&quot;.&quot;));</b>
&nbsp;						do {
<b class="nc">&nbsp;							newFilename += &quot;(Old)&quot;;</b>
<b class="nc">&nbsp;						} while (new File(newFilename).exists());</b>
<b class="nc">&nbsp;						newFilename += Save.extension;</b>
&nbsp;					}
&nbsp;				}
&nbsp;
<b class="nc">&nbsp;				Path newFile = new File(newFilename).toPath();</b>
<b class="nc">&nbsp;				newFile.getParent().toFile().mkdirs();</b>
&nbsp;				try {
<b class="nc">&nbsp;					Files.copy(file, newFile, StandardCopyOption.REPLACE_EXISTING);</b>
<b class="nc">&nbsp;				} catch (IOException ex) {</b>
<b class="nc">&nbsp;					CrashHandler.errorHandle(ex);</b>
<b class="nc">&nbsp;				}</b>
<b class="nc">&nbsp;				return FileVisitResult.CONTINUE;</b>
&nbsp;			}
&nbsp;
&nbsp;			public FileVisitResult preVisitDirectory(Path p, BasicFileAttributes bfa) {
<b class="nc">&nbsp;				return FileVisitResult.CONTINUE;</b>
&nbsp;			}
&nbsp;
&nbsp;			public FileVisitResult postVisitDirectory(Path p, IOException ex) {
<b class="nc">&nbsp;				return FileVisitResult.CONTINUE;</b>
&nbsp;			}
&nbsp;
&nbsp;			public FileVisitResult visitFileFailed(Path p, IOException ex) {
<b class="nc">&nbsp;				return FileVisitResult.CONTINUE;</b>
&nbsp;			}
&nbsp;		});
&nbsp;
<b class="nc">&nbsp;		if (deleteOriginal)</b>
<b class="nc">&nbsp;			deleteFolder(origFolder.toFile());</b>
&nbsp;	}
&nbsp;
&nbsp;	public static ArrayList&lt;String&gt; listAssets() {
&nbsp;		Path path;
&nbsp;		try {
<b class="nc">&nbsp;			path = Paths.get(Objects.requireNonNull(Game.class.getResource(&quot;/assets/&quot;)).toURI());</b>
<b class="nc">&nbsp;		} catch (URISyntaxException e) {</b>
<b class="nc">&nbsp;			throw new RuntimeException(e); // CRITICAL ERROR (GAME ASSETS)</b>
<b class="nc">&nbsp;		} catch (FileSystemNotFoundException e) {</b>
&nbsp;			try {
<b class="nc">&nbsp;				FileSystem fs = FileSystems.newFileSystem(Objects.requireNonNull(Game.class.getResource(&quot;/assets/&quot;)).toURI(), Collections.emptyMap());</b>
<b class="nc">&nbsp;				path = fs.getPath(&quot;/assets/&quot;);</b>
<b class="nc">&nbsp;			} catch (URISyntaxException | IOException ee1) {</b>
<b class="nc">&nbsp;				throw new RuntimeException(ee1); // CRITICAL ERROR (GAME ASSETS)</b>
<b class="nc">&nbsp;			}</b>
<b class="nc">&nbsp;		}</b>
&nbsp;
<b class="nc">&nbsp;		ArrayList&lt;String&gt; names = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;		try (Stream&lt;Path&gt; paths = Files.walk(path)) {</b>
<b class="nc">&nbsp;			Path finalPath = path;</b>
<b class="nc">&nbsp;			paths.forEach(p -&gt; names.add(finalPath.getParent().relativize(p).toString().replace(&#39;\\&#39;, &#39;/&#39;) +</b>
<b class="nc">&nbsp;				(p.toFile().isDirectory() ? &quot;/&quot; : &quot;&quot;)));</b>
<b class="nc">&nbsp;			return names;</b>
<b class="nc">&nbsp;		} catch (IOException e) {</b>
<b class="nc">&nbsp;			throw new RuntimeException(e); // CRITICAL ERROR (GAME ASSETS)</b>
&nbsp;		}
&nbsp;	}
&nbsp;
&nbsp;	/**
&nbsp;	 * Gets a list of paths to where the localization files are located on your disk, and adds them to the &quot;localizationFiles&quot; HashMap.
&nbsp;	 * The path is relative to the &quot;resources&quot; folder.
&nbsp;	 * Will not work if we are running this from a jar.
&nbsp;	 */
&nbsp;	private static ArrayList&lt;String&gt; listResourcesUsingIDE() {
<b class="nc">&nbsp;		ArrayList&lt;String&gt; names = new ArrayList&lt;&gt;();</b>
&nbsp;		try {
<b class="nc">&nbsp;			URL fUrl = Game.class.getResource(&quot;/&quot;);</b>
<b class="nc">&nbsp;			if (fUrl == null) {</b>
<b class="nc">&nbsp;				Logging.RESOURCEHANDLER_LOCALIZATION.error(&quot;Could not find localization folder.&quot;);</b>
<b class="nc">&nbsp;				return names;</b>
&nbsp;			}
&nbsp;
<b class="nc">&nbsp;			Path folderPath = Paths.get(fUrl.toURI());</b>
<b class="nc">&nbsp;			Files.walk(folderPath)</b>
<b class="nc">&nbsp;				.forEach(p -&gt; {</b>
<b class="nc">&nbsp;					names.add(folderPath.relativize(p).toString().replace(&#39;\\&#39;, &#39;/&#39;) + (p.toFile().isDirectory() ? &quot;/&quot; : &quot;&quot;));</b>
&nbsp;				});
&nbsp;
<b class="nc">&nbsp;			if (!names.contains(&quot;resources&quot;)) { // Providing a simple resolution when the previous location is invalid, the gradle build path is used.</b>
<b class="nc">&nbsp;				Path fPath = folderPath.resolve(&quot;../../../resources/main&quot;);</b>
<b class="nc">&nbsp;				Files.walk(fPath)</b>
<b class="nc">&nbsp;					.forEach(p -&gt; {</b>
<b class="nc">&nbsp;						names.add(fPath.relativize(p).toString().replace(&#39;\\&#39;, &#39;/&#39;) + (p.toFile().isDirectory() ? &quot;/&quot; : &quot;&quot;));</b>
&nbsp;					});
&nbsp;			}
<b class="nc">&nbsp;		} catch (IOException | URISyntaxException e) {</b>
<b class="nc">&nbsp;			CrashHandler.errorHandle(e);</b>
<b class="nc">&nbsp;		}</b>
&nbsp;
<b class="nc">&nbsp;		return names;</b>
&nbsp;	}
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2024-04-18 20:02</div>
</div>
</body>
</html>
